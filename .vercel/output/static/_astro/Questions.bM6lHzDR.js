import{d as L,o as I,a as J,w as x,r as Q,n as Tt,g as $t,c as Y,b as O,m as _e,e as X,p as lt,q as E,s as bn,h as R,t as Ce,F as gn,f as vn,i as _n,u as Sn,v as xn,j as Kt,x as Ys,y as Qs,z as W,A as ve,B as Gs,C as Rn,D as Js,E as qn,G as Ks,H as Xs}from"./runtime-dom.esm-bundler.Cf2R47Zf.js";import{_ as Z,x as ut,G as Cn,q as In,H as Tn,h as $n,g as An,w as En,X as er,c as oe,e as Pn,C as Dn,d as tr,u as kn,Q as nr}from"./index.5Svi-JpX.js";class T extends Error{code;rawCode;constructor(e,n,s,r){n!==void 0&&(e=`${n}: ${e}`),super(e,{cause:r}),this.code=n,this.rawCode=s,this.name="LibsqlError"}}function sr(t){const e=rr.exec(t);if(e===null)throw new T(`The URL '${t}' is not in a valid format`,"URL_INVALID");const n=e.groups,s=n.scheme,r=n.authority!==void 0?or(n.authority):void 0,o=we(n.path),i=n.query!==void 0?ar(n.query):void 0,a=n.fragment!==void 0?we(n.fragment):void 0;return{scheme:s,authority:r,path:o,query:i,fragment:a}}const rr=(()=>{const t="(?<scheme>[A-Za-z][A-Za-z.+-]*)",e="(?<authority>[^/?#]*)",n="(?<path>[^?#]*)",s="(?<query>[^#]*)",r="(?<fragment>.*)";return new RegExp(`^${t}:(//${e})?${n}(\\?${s})?(#${r})?$`,"su")})();function or(t){const e=ir.exec(t);if(e===null)throw new T("The authority part of the URL is not in a valid format","URL_INVALID");const n=e.groups,s=we(n.host_br??n.host),r=n.port?parseInt(n.port,10):void 0,o=n.username!==void 0?{username:we(n.username),password:n.password!==void 0?we(n.password):void 0}:void 0;return{host:s,port:r,userinfo:o}}const ir=new RegExp("^((?<username>[^:]*)(:(?<password>.*))?@)?((?<host>[^:\\[\\]]*)|(\\[(?<host_br>[^\\[\\]]*)\\]))(:(?<port>[0-9]*))?$","su");function ar(t){const e=t.split("&"),n=[];for(const s of e){if(s==="")continue;let r,o;const i=s.indexOf("=");i<0?(r=s,o=""):(r=s.substring(0,i),o=s.substring(i+1)),n.push({key:we(r.replaceAll("+"," ")),value:we(o.replaceAll("+"," "))})}return{pairs:n}}function we(t){try{return decodeURIComponent(t)}catch(e){throw e instanceof URIError?new T(`URL component has invalid percent encoding: ${e}`,"URL_INVALID",void 0,e):e}}function wt(t,e,n){if(e===void 0)throw new T(`URL with scheme ${JSON.stringify(t+":")} requires authority (the "//" part)`,"URL_INVALID");const s=`${t}:`,r=lr(e.host),o=ur(e.port),a=`//${cr(e.userinfo)}${r}${o}`;let l=n.split("/").map(encodeURIComponent).join("/");return l!==""&&!l.startsWith("/")&&(l="/"+l),new URL(`${s}${a}${l}`)}function lr(t){return t.includes(":")?`[${encodeURI(t)}]`:encodeURI(t)}function ur(t){return t!==void 0?`:${t}`:""}function cr(t){if(t===void 0)return"";const e=encodeURIComponent(t.username),n=t.password!==void 0?`:${encodeURIComponent(t.password)}`:"";return`${e}${n}@`}const On="3.7.7",dr=On,ke=typeof Buffer=="function",Xt=typeof TextDecoder=="function"?new TextDecoder:void 0,en=typeof TextEncoder=="function"?new TextEncoder:void 0,fr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Le=Array.prototype.slice.call(fr),Ke=(t=>{let e={};return t.forEach((n,s)=>e[n]=s),e})(Le),hr=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,V=String.fromCharCode.bind(String),tn=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),Un=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),Mn=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),Nn=t=>{let e,n,s,r,o="";const i=t.length%3;for(let a=0;a<t.length;){if((n=t.charCodeAt(a++))>255||(s=t.charCodeAt(a++))>255||(r=t.charCodeAt(a++))>255)throw new TypeError("invalid character found");e=n<<16|s<<8|r,o+=Le[e>>18&63]+Le[e>>12&63]+Le[e>>6&63]+Le[e&63]}return i?o.slice(0,i-3)+"===".substring(i):o},At=typeof btoa=="function"?t=>btoa(t):ke?t=>Buffer.from(t,"binary").toString("base64"):Nn,bt=ke?t=>Buffer.from(t).toString("base64"):t=>{let n=[];for(let s=0,r=t.length;s<r;s+=4096)n.push(V.apply(null,t.subarray(s,s+4096)));return At(n.join(""))},tt=(t,e=!1)=>e?Un(bt(t)):bt(t),pr=t=>{if(t.length<2){var e=t.charCodeAt(0);return e<128?t:e<2048?V(192|e>>>6)+V(128|e&63):V(224|e>>>12&15)+V(128|e>>>6&63)+V(128|e&63)}else{var e=65536+(t.charCodeAt(0)-55296)*1024+(t.charCodeAt(1)-56320);return V(240|e>>>18&7)+V(128|e>>>12&63)+V(128|e>>>6&63)+V(128|e&63)}},mr=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Bn=t=>t.replace(mr,pr),nn=ke?t=>Buffer.from(t,"utf8").toString("base64"):en?t=>bt(en.encode(t)):t=>At(Bn(t)),$e=(t,e=!1)=>e?Un(nn(t)):nn(t),sn=t=>$e(t,!0),yr=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,wr=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),n=e-65536;return V((n>>>10)+55296)+V((n&1023)+56320);case 3:return V((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return V((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},Ln=t=>t.replace(yr,wr),jn=t=>{if(t=t.replace(/\s+/g,""),!hr.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,n="",s,r;for(let o=0;o<t.length;)e=Ke[t.charAt(o++)]<<18|Ke[t.charAt(o++)]<<12|(s=Ke[t.charAt(o++)])<<6|(r=Ke[t.charAt(o++)]),n+=s===64?V(e>>16&255):r===64?V(e>>16&255,e>>8&255):V(e>>16&255,e>>8&255,e&255);return n},Et=typeof atob=="function"?t=>atob(Mn(t)):ke?t=>Buffer.from(t,"base64").toString("binary"):jn,Fn=ke?t=>tn(Buffer.from(t,"base64")):t=>tn(Et(t).split("").map(e=>e.charCodeAt(0))),Hn=t=>Fn(Vn(t)),br=ke?t=>Buffer.from(t,"base64").toString("utf8"):Xt?t=>Xt.decode(Fn(t)):t=>Ln(Et(t)),Vn=t=>Mn(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),gt=t=>br(Vn(t)),gr=t=>{if(typeof t!="string")return!1;const e=t.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)},zn=t=>({value:t,enumerable:!1,writable:!0,configurable:!0}),Zn=function(){const t=(e,n)=>Object.defineProperty(String.prototype,e,zn(n));t("fromBase64",function(){return gt(this)}),t("toBase64",function(e){return $e(this,e)}),t("toBase64URI",function(){return $e(this,!0)}),t("toBase64URL",function(){return $e(this,!0)}),t("toUint8Array",function(){return Hn(this)})},Wn=function(){const t=(e,n)=>Object.defineProperty(Uint8Array.prototype,e,zn(n));t("toBase64",function(e){return tt(this,e)}),t("toBase64URI",function(){return tt(this,!0)}),t("toBase64URL",function(){return tt(this,!0)})},vr=()=>{Zn(),Wn()},Pt={version:On,VERSION:dr,atob:Et,atobPolyfill:jn,btoa:At,btoaPolyfill:Nn,fromBase64:gt,toBase64:$e,encode:$e,encodeURI:sn,encodeURL:sn,utob:Bn,btou:Ln,decode:gt,isValid:gr,fromUint8Array:tt,toUint8Array:Hn,extendString:Zn,extendUint8Array:Wn,extendBuiltins:vr},Ve="https://github.com/libsql/libsql-client-ts#supported-urls";function vt(t){if(t==="write")return"BEGIN IMMEDIATE";if(t==="read")return"BEGIN TRANSACTION READONLY";if(t==="deferred")return"BEGIN DEFERRED";throw RangeError('Unknown transaction mode, supported values are "write", "read" and "deferred"')}class _r{columns;columnTypes;rows;rowsAffected;lastInsertRowid;constructor(e,n,s,r,o){this.columns=e,this.columnTypes=n,this.rows=s,this.rowsAffected=r,this.lastInsertRowid=o}toJSON(){return{columns:this.columns,columnTypes:this.columnTypes,rows:this.rows.map(Sr),rowsAffected:this.rowsAffected,lastInsertRowid:this.lastInsertRowid!==void 0?""+this.lastInsertRowid:null}}}function Sr(t){return Array.prototype.map.call(t,xr)}function xr(t){return typeof t=="bigint"?""+t:t instanceof ArrayBuffer?Pt.fromUint8Array(new Uint8Array(t)):t}const rn=":memory:";function Rr(t,e){if(typeof t!="object")throw new TypeError(`Expected client configuration as object, got ${typeof t}`);let{url:n,authToken:s,tls:r,intMode:o,concurrency:i}=t;i=Math.max(0,i||20),o??="number";let a=[];n===rn&&(n="file::memory:");const l=sr(n),c=l.scheme.toLowerCase(),u=c==="file"&&l.path===rn&&l.authority===void 0;let f;u?f={cache:{values:["shared","private"],update:(d,p)=>a.push(`${d}=${p}`)}}:f={tls:{values:["0","1"],update:(d,p)=>r=p==="1"},authToken:{update:(d,p)=>s=p}};for(const{key:d,value:p}of l.query?.pairs??[]){if(!Object.hasOwn(f,d))throw new T(`Unsupported URL query parameter ${JSON.stringify(d)}`,"URL_PARAM_NOT_SUPPORTED");const b=f[d];if(b.values!==void 0&&!b.values.includes(p))throw new T(`Unknown value for the "${d}" query argument: ${JSON.stringify(p)}. Supported values are: [${b.values.map(v=>'"'+v+'"').join(", ")}]`,"URL_INVALID");b.update!==void 0&&b?.update(d,p)}const y=a.length===0?"":`?${a.join("&")}`,m=l.path+y;let h;if(c==="libsql")if(r===!1){if(l.authority?.port===void 0)throw new T('A "libsql:" URL with ?tls=0 must specify an explicit port',"URL_INVALID");h="http"}else h="https";else h=c;if(h==="http"||h==="ws"?r??=!1:r??=!0,h!=="http"&&h!=="ws"&&h!=="https"&&h!=="wss"&&h!=="file")throw new T(`The client supports only "libsql:", "wss:", "ws:", "https:", "http:" and "file:" URLs, got ${JSON.stringify(l.scheme+":")}. For more information, please read ${Ve}`,"URL_SCHEME_NOT_SUPPORTED");if(o!=="number"&&o!=="bigint"&&o!=="string")throw new TypeError(`Invalid value for intMode, expected "number", "bigint" or "string", got ${JSON.stringify(o)}`);if(l.fragment!==void 0)throw new T(`URL fragments are not supported: ${JSON.stringify("#"+l.fragment)}`,"URL_INVALID");return u?{scheme:"file",tls:!1,path:m,intMode:o,concurrency:i,syncUrl:t.syncUrl,syncInterval:t.syncInterval,fetch:t.fetch,authToken:void 0,encryptionKey:void 0,authority:void 0}:{scheme:h,tls:r,authority:l.authority,path:m,authToken:s,intMode:o,concurrency:i,encryptionKey:t.encryptionKey,syncUrl:t.syncUrl,syncInterval:t.syncInterval,fetch:t.fetch}}let Ie;typeof WebSocket<"u"?Ie=WebSocket:typeof global<"u"?Ie=global.WebSocket:typeof window<"u"?Ie=window.WebSocket:typeof self<"u"&&(Ie=self.WebSocket);class Yn{constructor(){this.intMode="number"}intMode}class U extends Error{constructor(e){super(e),this.name="ClientError"}}class g extends U{constructor(e){super(e),this.name="ProtoError"}}class Qn extends U{code;proto;constructor(e,n){super(e),this.name="ResponseError",this.code=n.code,this.proto=n,this.stack=void 0}}class ee extends U{constructor(e,n){n!==void 0?(super(`${e}: ${n}`),this.cause=n):super(e),this.name="ClosedError"}}class Gn extends U{constructor(e){super(e),this.name="WebSocketUnsupportedError"}}class _t extends U{constructor(e){super(e),this.name="WebSocketError"}}class Jn extends U{status;constructor(e,n){super(e),this.status=n,this.name="HttpServerError"}}class Ae extends U{constructor(e){super(e),this.name="ProtocolVersionError"}}class ce extends U{constructor(e){super(e),this.name="InternalError"}}class Oe extends U{constructor(e){super(e),this.name="MisuseError"}}function se(t){if(typeof t=="string")return t;throw Ue(t,"string")}function re(t){if(t!=null){if(typeof t=="string")return t;throw Ue(t,"string or null")}}function be(t){if(typeof t=="number")return t;throw Ue(t,"number")}function ze(t){if(typeof t=="boolean")return t;throw Ue(t,"boolean")}function nt(t){if(Array.isArray(t))return t;throw Ue(t,"array")}function z(t){if(t!==null&&typeof t=="object"&&!Array.isArray(t))return t;throw Ue(t,"object")}function de(t,e){return nt(t).map(n=>e(z(n)))}function Ue(t,e){if(t===void 0)return new g(`Expected ${e}, but the property was missing`);let n=typeof t;return t===null?n="null":Array.isArray(t)&&(n="array"),new g(`Expected ${e}, received ${n}`)}function Dt(t,e){return e(z(t))}class qr{#e;#t;constructor(e){this.#e=e,this.#t=!1}begin(){this.#e.push("{"),this.#t=!0}end(){this.#e.push("}"),this.#t=!1}#n(e){this.#t?(this.#e.push('"'),this.#t=!1):this.#e.push(',"'),this.#e.push(e),this.#e.push('":')}string(e,n){this.#n(e),this.#e.push(JSON.stringify(n))}stringRaw(e,n){this.#n(e),this.#e.push('"'),this.#e.push(n),this.#e.push('"')}number(e,n){this.#n(e),this.#e.push(""+n)}boolean(e,n){this.#n(e),this.#e.push(n?"true":"false")}object(e,n,s){this.#n(e),this.begin(),s(this,n),this.end()}arrayObjects(e,n,s){this.#n(e),this.#e.push("[");for(let r=0;r<n.length;++r)r!==0&&this.#e.push(","),this.begin(),s(this,n[r]),this.end();this.#e.push("]")}}function Kn(t,e){const n=[],s=new qr(n);return s.begin(),e(s,t),s.end(),n.join("")}const Fe=0,St=1,xt=2,Cr=5;class Ir{#e;#t;#n;constructor(e){this.#e=e,this.#t=new DataView(e.buffer,e.byteOffset,e.byteLength),this.#n=0}varint(){let e=0;for(let n=0;;n+=7){const s=this.#e[this.#n++];if(e|=(s&127)<<n,!(s&128))break}return e}varintBig(){let e=0n;for(let n=0n;;n+=7n){const s=this.#e[this.#n++];if(e|=BigInt(s&127)<<n,!(s&128))break}return e}bytes(e){const n=new Uint8Array(this.#e.buffer,this.#e.byteOffset+this.#n,e);return this.#n+=e,n}double(){const e=this.#t.getFloat64(this.#n,!0);return this.#n+=8,e}skipVarint(){for(;this.#e[this.#n++]&128;);}skip(e){this.#n+=e}eof(){return this.#n>=this.#e.byteLength}}class Tr{#e;#t;constructor(e){this.#e=e,this.#t=-1}setup(e){this.#t=e}#n(e){if(this.#t!==e)throw new g(`Expected wire type ${e}, got ${this.#t}`);this.#t=-1}bytes(){this.#n(xt);const e=this.#e.varint();return this.#e.bytes(e)}string(){return new TextDecoder().decode(this.bytes())}message(e){return ct(this.bytes(),e)}int32(){return this.#n(Fe),this.#e.varint()}uint32(){return this.int32()}bool(){return this.int32()!==0}uint64(){return this.#n(Fe),this.#e.varintBig()}sint64(){const e=this.uint64();return e>>1n^-(e&1n)}double(){return this.#n(St),this.#e.double()}maybeSkip(){if(!(this.#t<0)){if(this.#t===Fe)this.#e.skipVarint();else if(this.#t===St)this.#e.skip(8);else if(this.#t===xt){const e=this.#e.varint();this.#e.skip(e)}else if(this.#t===Cr)this.#e.skip(4);else throw new g(`Unexpected wire type ${this.#t}`);this.#t=-1}}}function ct(t,e){const n=new Ir(t),s=new Tr(n);let r=e.default();for(;!n.eof();){const o=n.varint(),i=o>>3,a=o&7;s.setup(a);const l=e[i];if(l!==void 0){const c=l(s,r);c!==void 0&&(r=c)}s.maybeSkip()}return r}class kt{#e;#t;#n;#s;constructor(){this.#e=new ArrayBuffer(256),this.#t=new Uint8Array(this.#e),this.#n=new DataView(this.#e),this.#s=0}#o(e){if(this.#s+e<=this.#e.byteLength)return;let n=this.#e.byteLength;for(;n<this.#s+e;)n*=2;const s=new ArrayBuffer(n),r=new Uint8Array(s),o=new DataView(s);r.set(new Uint8Array(this.#e,0,this.#s)),this.#e=s,this.#t=r,this.#n=o}#r(e){this.#o(5),e=0|e;do{let n=e&127;e>>>=7,n|=e?128:0,this.#t[this.#s++]=n}while(e)}#a(e){this.#o(10),e=e&0xffffffffffffffffn;do{let n=Number(e&0x7fn);e>>=7n,n|=e?128:0,this.#t[this.#s++]=n}while(e)}#i(e,n){this.#r(e<<3|n)}bytes(e,n){this.#i(e,xt),this.#r(n.byteLength),this.#o(n.byteLength),this.#t.set(n,this.#s),this.#s+=n.byteLength}string(e,n){this.bytes(e,new TextEncoder().encode(n))}message(e,n,s){const r=new kt;s(r,n),this.bytes(e,r.data())}int32(e,n){this.#i(e,Fe),this.#r(n)}uint32(e,n){this.int32(e,n)}bool(e,n){this.int32(e,n?1:0)}sint64(e,n){this.#i(e,Fe),this.#a(n<<1n^n>>63n)}double(e,n){this.#i(e,St),this.#o(8),this.#n.setFloat64(this.#s,n,!0),this.#s+=8}data(){return new Uint8Array(this.#e,0,this.#s)}}function Xn(t,e){const n=new kt;return e(n,t),n.data()}class je{#e;#t;constructor(){this.#e=new Set,this.#t=new Set}alloc(){for(const n of this.#t)return this.#t.delete(n),this.#e.add(n),this.#e.has(this.#e.size-1)||this.#t.add(this.#e.size-1),n;const e=this.#e.size;return this.#e.add(e),e}free(e){if(!this.#e.delete(e))throw new ce("Freeing an id that is not allocated");this.#t.delete(this.#e.size),e<this.#e.size&&this.#t.add(e)}}function B(t,e){throw new ce(e)}function He(t){if(t===null)return null;if(typeof t=="string")return t;if(typeof t=="number"){if(!Number.isFinite(t))throw new RangeError("Only finite numbers (not Infinity or NaN) can be passed as arguments");return t}else if(typeof t=="bigint"){if(t<$r||t>Ar)throw new RangeError("This bigint value is too large to be represented as a 64-bit integer and passed as argument");return t}else{if(typeof t=="boolean")return t?1n:0n;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(t instanceof Uint8Array)return t;if(t instanceof Date)return+t.valueOf();if(typeof t=="object")return""+t.toString();throw new TypeError("Unsupported type of value")}}const $r=-9223372036854775808n,Ar=9223372036854775807n;function es(t,e){if(t===null)return null;if(typeof t=="number")return t;if(typeof t=="string")return t;if(typeof t=="bigint")if(e==="number"){const n=Number(t);if(!Number.isSafeInteger(n))throw new RangeError("Received integer which is too large to be safely represented as a JavaScript number");return n}else{if(e==="bigint")return t;if(e==="string")return""+t;throw new Oe("Invalid value for IntMode")}else{if(t instanceof Uint8Array)return t.slice().buffer;throw t===void 0?new g("Received unrecognized type of Value"):B(t,"Impossible type of Value")}}function Ze(t){return{affectedRowCount:t.affectedRowCount,lastInsertRowid:t.lastInsertRowid,columnNames:t.cols.map(e=>e.name),columnDecltypes:t.cols.map(e=>e.decltype)}}function ts(t,e){const n=Ze(t),s=t.rows.map(r=>rs(n.columnNames,r,e));return{...n,rows:s}}function ns(t,e){const n=Ze(t);let s;return t.rows.length>0&&(s=rs(n.columnNames,t.rows[0],e)),{...n,row:s}}function ss(t,e){const n=Ze(t);let s;return t.rows.length>0&&n.columnNames.length>0&&(s=es(t.rows[0][0],e)),{...n,value:s}}function rs(t,e,n){const s={};Object.defineProperty(s,"length",{value:e.length});for(let r=0;r<e.length;++r){const o=es(e[r],n);Object.defineProperty(s,r,{value:o});const i=t[r];i!==void 0&&!Object.hasOwn(s,i)&&Object.defineProperty(s,i,{value:o,enumerable:!0,configurable:!0,writable:!0})}return s}function Ee(t){return new Qn(t.message,t)}class Ot{#e;#t;#n;constructor(e,n){this.#e=e,this.#t=n,this.#n=void 0}_getSqlId(e){if(this.#e!==e)throw new Oe("Attempted to use SQL text opened with other object");if(this.#n!==void 0)throw new ee("SQL text is closed",this.#n);return this.#t}close(){this._setClosed(new U("SQL text was manually closed"))}_setClosed(e){this.#n===void 0&&(this.#n=e,this.#e._closeSql(this.#t))}get closed(){return this.#n!==void 0}}function Rt(t,e){return e instanceof Ot?{sqlId:e._getSqlId(t)}:{sql:""+e}}class st{#e;#t;constructor(){this.#e=[],this.#t=[]}get length(){return this.#e.length+this.#t.length}push(e){this.#e.push(e)}shift(){return this.#t.length===0&&this.#e.length>0&&(this.#t=this.#e.reverse(),this.#e=[]),this.#t.pop()}first(){return this.#t.length!==0?this.#t[this.#t.length-1]:this.#e[0]}}let qt=class{sql;_args;_namedArgs;constructor(e){this.sql=e,this._args=[],this._namedArgs=new Map}bindIndexes(e){this._args.length=0;for(const n of e)this._args.push(He(n));return this}bindIndex(e,n){if(e!==(e|0)||e<=0)throw new RangeError("Index of a positional argument must be positive integer");for(;this._args.length<e;)this._args.push(null);return this._args[e-1]=He(n),this}bindName(e,n){return this._namedArgs.set(e,He(n)),this}unbindAll(){return this._args.length=0,this._namedArgs.clear(),this}};function os(t,e,n){let s,r=[],o=[];if(e instanceof qt){s=e.sql,r=e._args;for(const[l,c]of e._namedArgs.entries())o.push({name:l,value:c})}else Array.isArray(e)?(s=e[0],Array.isArray(e[1])?r=e[1].map(l=>He(l)):o=Object.entries(e[1]).map(([l,c])=>({name:l,value:He(c)}))):s=e;const{sql:i,sqlId:a}=Rt(t,s);return{sql:i,sqlId:a,args:r,namedArgs:o,wantRows:n}}let Er=class{_stream;#e;_steps;#t;constructor(e,n){this._stream=e,this.#e=n,this._steps=[],this.#t=!1}step(){return new kr(this)}execute(){if(this.#t)throw new Oe("This batch has already been executed");this.#t=!0;const e={steps:this._steps.map(n=>n.proto)};return this.#e?Dr(this._stream,this._steps,e):Pr(this._stream,this._steps,e)}};function Pr(t,e,n){return t._batch(n).then(s=>{for(let r=0;r<e.length;++r){const o=s.stepResults.get(r),i=s.stepErrors.get(r);e[r].callback(o,i)}})}async function Dr(t,e,n){const s=await t._openCursor(n);try{let r=0,o,i=[];for(;;){const a=await s.next();if(a===void 0)break;if(a.type==="step_begin"){if(a.step<r||a.step>=e.length)throw new g("Server produced StepBeginEntry for unexpected step");if(o!==void 0)throw new g("Server produced StepBeginEntry before terminating previous step");for(let l=r;l<a.step;++l)e[l].callback(void 0,void 0);r=a.step+1,o=a,i=[]}else if(a.type==="step_end"){if(o===void 0)throw new g("Server produced StepEndEntry but no step is active");const l={cols:o.cols,rows:i,affectedRowCount:a.affectedRowCount,lastInsertRowid:a.lastInsertRowid};e[o.step].callback(l,void 0),o=void 0,i=[]}else if(a.type==="step_error"){if(o===void 0){if(a.step>=e.length)throw new g("Server produced StepErrorEntry for unexpected step");for(let l=r;l<a.step;++l)e[l].callback(void 0,void 0)}else{if(a.step!==o.step)throw new g("Server produced StepErrorEntry for unexpected step");o=void 0,i=[]}e[a.step].callback(void 0,a.error),r=a.step+1}else if(a.type==="row"){if(o===void 0)throw new g("Server produced RowEntry but no step is active");i.push(a.row)}else throw a.type==="error"?Ee(a.error):a.type==="none"?new g("Server produced unrecognized CursorEntry"):B(a,"Impossible CursorEntry")}if(o!==void 0)throw new g("Server closed Cursor before terminating active step");for(let a=r;a<e.length;++a)e[a].callback(void 0,void 0)}finally{s.close()}}let kr=class{_batch;#e;_index;constructor(e){this._batch=e,this.#e=[],this._index=void 0}condition(e){return this.#e.push(e._proto),this}query(e){return this.#t(e,!0,ts)}queryRow(e){return this.#t(e,!0,ns)}queryValue(e){return this.#t(e,!0,ss)}run(e){return this.#t(e,!1,Ze)}#t(e,n,s){if(this._index!==void 0)throw new Oe("This BatchStep has already been added to the batch");const r=os(this._batch._stream._sqlOwner(),e,n);let o;this.#e.length===0?o=void 0:this.#e.length===1?o=this.#e[0]:o={type:"and",conds:this.#e.slice()};const i={stmt:r,condition:o};return new Promise((a,l)=>{const c=(u,f)=>{u!==void 0&&f!==void 0?l(new g("Server returned both result and error")):f!==void 0?l(Ee(f)):a(u!==void 0?s(u,this._batch._stream.intMode):void 0)};this._index=this._batch._steps.length,this._batch._steps.push({proto:i,callback:c})})}},K=class ye{_batch;_proto;constructor(e,n){this._batch=e,this._proto=n}static ok(e){return new ye(e._batch,{type:"ok",step:on(e)})}static error(e){return new ye(e._batch,{type:"error",step:on(e)})}static not(e){return new ye(e._batch,{type:"not",cond:e._proto})}static and(e,n){for(const s of n)an(e,s);return new ye(e,{type:"and",conds:n.map(s=>s._proto)})}static or(e,n){for(const s of n)an(e,s);return new ye(e,{type:"or",conds:n.map(s=>s._proto)})}static isAutocommit(e){return e._stream.client()._ensureVersion(3,"BatchCond.isAutocommit()"),new ye(e,{type:"is_autocommit"})}};function on(t){if(t._index===void 0)throw new Oe("Cannot add a condition referencing a step that has not been added to the batch");return t._index}function an(t,e){if(e._batch!==t)throw new Oe("Cannot mix BatchCond objects for different Batch objects")}function Or(t){return{paramNames:t.params.map(e=>e.name),columns:t.cols,isExplain:t.isExplain,isReadonly:t.isReadonly}}class is{constructor(e){this.intMode=e}query(e){return this.#e(e,!0,ts)}queryRow(e){return this.#e(e,!0,ns)}queryValue(e){return this.#e(e,!0,ss)}run(e){return this.#e(e,!1,Ze)}#e(e,n,s){const r=os(this._sqlOwner(),e,n);return this._execute(r).then(o=>s(o,this.intMode))}batch(e=!1){return new Er(this,e)}describe(e){const n=Rt(this._sqlOwner(),e);return this._describe(n).then(Or)}sequence(e){const n=Rt(this._sqlOwner(),e);return this._sequence(n)}intMode}class as{}const Ur=1e3,Mr=10;class Nr extends as{#e;#t;#n;#s;#o;#r;#a;constructor(e,n,s){super(),this.#e=e,this.#t=n,this.#n=s,this.#s=new st,this.#o=new st,this.#r=void 0,this.#a=!1}async next(){for(;;){if(this.#r!==void 0)throw new ee("Cursor is closed",this.#r);for(;!this.#a&&this.#o.length<Mr;)this.#o.push(this.#i());const e=this.#s.shift();if(this.#a||e!==void 0)return e;await this.#o.shift().then(n=>{if(n!==void 0){for(const s of n.entries)this.#s.push(s);this.#a||=n.done}})}}#i(){return this.#t._sendCursorRequest(this,{type:"fetch_cursor",cursorId:this.#n,maxCount:Ur}).then(e=>e,e=>{this._setClosed(e)})}_setClosed(e){this.#r===void 0&&(this.#r=e,this.#t._sendCursorRequest(this,{type:"close_cursor",cursorId:this.#n}).catch(()=>{}),this.#t._cursorClosed(this))}close(){this._setClosed(new U("Cursor was manually closed"))}get closed(){return this.#r!==void 0}}class Ut extends is{#e;#t;#n;#s;#o;#r;static open(e){const n=e._streamIdAlloc.alloc(),s=new Ut(e,n),r=()=>{},o=a=>s.#u(a),i={type:"open_stream",streamId:n};return e._sendRequest(i,{responseCallback:r,errorCallback:o}),s}constructor(e,n){super(e.intMode),this.#e=e,this.#t=n,this.#n=new st,this.#s=void 0,this.#o=!1,this.#r=void 0}client(){return this.#e}_sqlOwner(){return this.#e}_execute(e){return this.#a({type:"execute",streamId:this.#t,stmt:e}).then(n=>n.result)}_batch(e){return this.#a({type:"batch",streamId:this.#t,batch:e}).then(n=>n.result)}_describe(e){return this.#e._ensureVersion(2,"describe()"),this.#a({type:"describe",streamId:this.#t,sql:e.sql,sqlId:e.sqlId}).then(n=>n.result)}_sequence(e){return this.#e._ensureVersion(2,"sequence()"),this.#a({type:"sequence",streamId:this.#t,sql:e.sql,sqlId:e.sqlId}).then(n=>{})}getAutocommit(){return this.#e._ensureVersion(3,"getAutocommit()"),this.#a({type:"get_autocommit",streamId:this.#t}).then(e=>e.isAutocommit)}#a(e){return new Promise((n,s)=>{this.#i({type:"request",request:e,responseCallback:n,errorCallback:s})})}_openCursor(e){return this.#e._ensureVersion(3,"cursor"),new Promise((n,s)=>{this.#i({type:"cursor",batch:e,cursorCallback:n,errorCallback:s})})}_sendCursorRequest(e,n){if(e!==this.#s)throw new ce("Cursor not associated with the stream attempted to execute a request");return new Promise((s,r)=>{this.#r!==void 0?r(new ee("Stream is closed",this.#r)):this.#e._sendRequest(n,{responseCallback:s,errorCallback:r})})}_cursorClosed(e){if(e!==this.#s)throw new ce("Cursor was closed, but it was not associated with the stream");this.#s=void 0,this.#l()}#i(e){this.#r!==void 0?e.errorCallback(new ee("Stream is closed",this.#r)):this.#o?e.errorCallback(new ee("Stream is closing",void 0)):(this.#n.push(e),this.#l())}#l(){for(;;){const e=this.#n.first();if(e===void 0&&this.#s===void 0&&this.#o){this.#u(new U("Stream was gracefully closed"));break}else if(e?.type==="request"&&this.#s===void 0){const{request:n,responseCallback:s,errorCallback:r}=e;this.#n.shift(),this.#e._sendRequest(n,{responseCallback:s,errorCallback:r})}else if(e?.type==="cursor"&&this.#s===void 0){const{batch:n,cursorCallback:s}=e;this.#n.shift();const r=this.#e._cursorIdAlloc.alloc(),o=new Nr(this.#e,this,r),i={type:"open_cursor",streamId:this.#t,cursorId:r,batch:n},a=()=>{},l=c=>o._setClosed(c);this.#e._sendRequest(i,{responseCallback:a,errorCallback:l}),this.#s=o,s(o)}else break}}#u(e){if(this.#r!==void 0)return;for(this.#r=e,this.#s!==void 0&&this.#s._setClosed(e);;){const o=this.#n.shift();if(o!==void 0)o.errorCallback(e);else break}const n={type:"close_stream",streamId:this.#t},s=()=>this.#e._streamIdAlloc.free(this.#t),r=()=>{};this.#e._sendRequest(n,{responseCallback:s,errorCallback:r})}close(){this.#u(new U("Stream was manually closed"))}closeGracefully(){this.#o=!0,this.#l()}get closed(){return this.#r!==void 0||this.#o}}function Mt(t,e){e.sql!==void 0&&t.string("sql",e.sql),e.sqlId!==void 0&&t.number("sql_id",e.sqlId),t.arrayObjects("args",e.args,ls),t.arrayObjects("named_args",e.namedArgs,Br),t.boolean("want_rows",e.wantRows)}function Br(t,e){t.string("name",e.name),t.object("value",e.value,ls)}function rt(t,e){t.arrayObjects("steps",e.steps,Lr)}function Lr(t,e){e.condition!==void 0&&t.object("condition",e.condition,Ct),t.object("stmt",e.stmt,Mt)}function Ct(t,e){if(t.stringRaw("type",e.type),e.type==="ok"||e.type==="error")t.number("step",e.step);else if(e.type==="not")t.object("cond",e.cond,Ct);else if(e.type==="and"||e.type==="or")t.arrayObjects("conds",e.conds,Ct);else if(e.type!=="is_autocommit")throw B(e,"Impossible type of BatchCond")}function ls(t,e){if(e===null)t.stringRaw("type","null");else if(typeof e=="bigint")t.stringRaw("type","integer"),t.stringRaw("value",""+e);else if(typeof e=="number")t.stringRaw("type","float"),t.number("value",e);else if(typeof e=="string")t.stringRaw("type","text"),t.string("value",e);else if(e instanceof Uint8Array)t.stringRaw("type","blob"),t.stringRaw("base64",Pt.fromUint8Array(e));else if(e!==void 0)throw B(e,"Impossible type of Value")}function jr(t,e){if(t.stringRaw("type",e.type),e.type==="hello")e.jwt!==void 0&&t.string("jwt",e.jwt);else if(e.type==="request")t.number("request_id",e.requestId),t.object("request",e.request,Fr);else throw B(e,"Impossible type of ClientMsg")}function Fr(t,e){if(t.stringRaw("type",e.type),e.type==="open_stream")t.number("stream_id",e.streamId);else if(e.type==="close_stream")t.number("stream_id",e.streamId);else if(e.type==="execute")t.number("stream_id",e.streamId),t.object("stmt",e.stmt,Mt);else if(e.type==="batch")t.number("stream_id",e.streamId),t.object("batch",e.batch,rt);else if(e.type==="open_cursor")t.number("stream_id",e.streamId),t.number("cursor_id",e.cursorId),t.object("batch",e.batch,rt);else if(e.type==="close_cursor")t.number("cursor_id",e.cursorId);else if(e.type==="fetch_cursor")t.number("cursor_id",e.cursorId),t.number("max_count",e.maxCount);else if(e.type==="sequence")t.number("stream_id",e.streamId),e.sql!==void 0&&t.string("sql",e.sql),e.sqlId!==void 0&&t.number("sql_id",e.sqlId);else if(e.type==="describe")t.number("stream_id",e.streamId),e.sql!==void 0&&t.string("sql",e.sql),e.sqlId!==void 0&&t.number("sql_id",e.sqlId);else if(e.type==="store_sql")t.number("sql_id",e.sqlId),t.string("sql",e.sql);else if(e.type==="close_sql")t.number("sql_id",e.sqlId);else if(e.type==="get_autocommit")t.number("stream_id",e.streamId);else throw B(e,"Impossible type of Request")}function Nt(t,e){e.sql!==void 0&&t.string(1,e.sql),e.sqlId!==void 0&&t.int32(2,e.sqlId);for(const n of e.args)t.message(3,n,us);for(const n of e.namedArgs)t.message(4,n,Hr);t.bool(5,e.wantRows)}function Hr(t,e){t.string(1,e.name),t.message(2,e.value,us)}function dt(t,e){for(const n of e.steps)t.message(1,n,Vr)}function Vr(t,e){e.condition!==void 0&&t.message(1,e.condition,Bt),t.message(2,e.stmt,Nt)}function Bt(t,e){if(e.type==="ok")t.uint32(1,e.step);else if(e.type==="error")t.uint32(2,e.step);else if(e.type==="not")t.message(3,e.cond,Bt);else if(e.type==="and")t.message(4,e.conds,ln);else if(e.type==="or")t.message(5,e.conds,ln);else if(e.type==="is_autocommit")t.message(6,void 0,cs);else throw B(e,"Impossible type of BatchCond")}function ln(t,e){for(const n of e)t.message(1,n,Bt)}function us(t,e){if(e===null)t.message(1,void 0,cs);else if(typeof e=="bigint")t.sint64(2,e);else if(typeof e=="number")t.double(3,e);else if(typeof e=="string")t.string(4,e);else if(e instanceof Uint8Array)t.bytes(5,e);else if(e!==void 0)throw B(e,"Impossible type of Value")}function cs(t,e){}function zr(t,e){if(e.type==="hello")t.message(1,e,Zr);else if(e.type==="request")t.message(2,e,Wr);else throw B(e,"Impossible type of ClientMsg")}function Zr(t,e){e.jwt!==void 0&&t.string(1,e.jwt)}function Wr(t,e){t.int32(1,e.requestId);const n=e.request;if(n.type==="open_stream")t.message(2,n,Yr);else if(n.type==="close_stream")t.message(3,n,Qr);else if(n.type==="execute")t.message(4,n,Gr);else if(n.type==="batch")t.message(5,n,Jr);else if(n.type==="open_cursor")t.message(6,n,Kr);else if(n.type==="close_cursor")t.message(7,n,Xr);else if(n.type==="fetch_cursor")t.message(8,n,eo);else if(n.type==="sequence")t.message(9,n,to);else if(n.type==="describe")t.message(10,n,no);else if(n.type==="store_sql")t.message(11,n,so);else if(n.type==="close_sql")t.message(12,n,ro);else if(n.type==="get_autocommit")t.message(13,n,oo);else throw B(n,"Impossible type of Request")}function Yr(t,e){t.int32(1,e.streamId)}function Qr(t,e){t.int32(1,e.streamId)}function Gr(t,e){t.int32(1,e.streamId),t.message(2,e.stmt,Nt)}function Jr(t,e){t.int32(1,e.streamId),t.message(2,e.batch,dt)}function Kr(t,e){t.int32(1,e.streamId),t.int32(2,e.cursorId),t.message(3,e.batch,dt)}function Xr(t,e){t.int32(1,e.cursorId)}function eo(t,e){t.int32(1,e.cursorId),t.uint32(2,e.maxCount)}function to(t,e){t.int32(1,e.streamId),e.sql!==void 0&&t.string(2,e.sql),e.sqlId!==void 0&&t.int32(3,e.sqlId)}function no(t,e){t.int32(1,e.streamId),e.sql!==void 0&&t.string(2,e.sql),e.sqlId!==void 0&&t.int32(3,e.sqlId)}function so(t,e){t.int32(1,e.sqlId),t.string(2,e.sql)}function ro(t,e){t.int32(1,e.sqlId)}function oo(t,e){t.int32(1,e.streamId)}function Pe(t){const e=se(t.message),n=re(t.code);return{message:e,code:n}}function Lt(t){const e=de(t.cols,ds),n=nt(t.rows).map(i=>de(i,ms)),s=be(t.affected_row_count),r=re(t.last_insert_rowid),o=r!==void 0?BigInt(r):void 0;return{cols:e,rows:n,affectedRowCount:s,lastInsertRowid:o}}function ds(t){const e=re(t.name),n=re(t.decltype);return{name:e,decltype:n}}function fs(t){const e=new Map;nt(t.step_results).forEach((s,r)=>{s!==null&&e.set(r,Lt(z(s)))});const n=new Map;return nt(t.step_errors).forEach((s,r)=>{s!==null&&n.set(r,Pe(z(s)))}),{stepResults:e,stepErrors:n}}function hs(t){const e=se(t.type);if(e==="step_begin"){const n=be(t.step),s=de(t.cols,ds);return{type:"step_begin",step:n,cols:s}}else if(e==="step_end"){const n=be(t.affected_row_count),s=re(t.last_insert_rowid),r=s!==void 0?BigInt(s):void 0;return{type:"step_end",affectedRowCount:n,lastInsertRowid:r}}else if(e==="step_error"){const n=be(t.step),s=Pe(z(t.error));return{type:"step_error",step:n,error:s}}else{if(e==="row")return{type:"row",row:de(t.row,ms)};if(e==="error")return{type:"error",error:Pe(z(t.error))};throw new g("Unexpected type of CursorEntry")}}function ps(t){const e=de(t.params,io),n=de(t.cols,ao),s=ze(t.is_explain),r=ze(t.is_readonly);return{params:e,cols:n,isExplain:s,isReadonly:r}}function io(t){return{name:re(t.name)}}function ao(t){const e=se(t.name),n=re(t.decltype);return{name:e,decltype:n}}function ms(t){const e=se(t.type);if(e==="null")return null;if(e==="integer"){const n=se(t.value);return BigInt(n)}else{if(e==="float")return be(t.value);if(e==="text")return se(t.value);if(e==="blob")return Pt.toUint8Array(se(t.base64));throw new g("Unexpected type of Value")}}function lo(t){const e=se(t.type);if(e==="hello_ok")return{type:"hello_ok"};if(e==="hello_error")return{type:"hello_error",error:Pe(z(t.error))};if(e==="response_ok"){const n=be(t.request_id),s=uo(z(t.response));return{type:"response_ok",requestId:n,response:s}}else if(e==="response_error"){const n=be(t.request_id),s=Pe(z(t.error));return{type:"response_error",requestId:n,error:s}}else throw new g("Unexpected type of ServerMsg")}function uo(t){const e=se(t.type);if(e==="open_stream")return{type:"open_stream"};if(e==="close_stream")return{type:"close_stream"};if(e==="execute")return{type:"execute",result:Lt(z(t.result))};if(e==="batch")return{type:"batch",result:fs(z(t.result))};if(e==="open_cursor")return{type:"open_cursor"};if(e==="close_cursor")return{type:"close_cursor"};if(e==="fetch_cursor"){const n=de(t.entries,hs),s=ze(t.done);return{type:"fetch_cursor",entries:n,done:s}}else{if(e==="sequence")return{type:"sequence"};if(e==="describe")return{type:"describe",result:ps(z(t.result))};if(e==="store_sql")return{type:"store_sql"};if(e==="close_sql")return{type:"close_sql"};if(e==="get_autocommit")return{type:"get_autocommit",isAutocommit:ze(t.is_autocommit)};throw new g("Unexpected type of Response")}}const ae={default(){return{message:"",code:void 0}},1(t,e){e.message=t.string()},2(t,e){e.code=t.string()}},De={default(){return{cols:[],rows:[],affectedRowCount:0,lastInsertRowid:void 0}},1(t,e){e.cols.push(t.message(ys))},2(t,e){e.rows.push(t.message(ws))},3(t,e){e.affectedRowCount=Number(t.uint64())},4(t,e){e.lastInsertRowid=t.sint64()}},ys={default(){return{name:void 0,decltype:void 0}},1(t,e){e.name=t.string()},2(t,e){e.decltype=t.string()}},ws={default(){return[]},1(t,e){e.push(t.message(bo))}},ot={default(){return{stepResults:new Map,stepErrors:new Map}},1(t,e){const[n,s]=t.message(co);e.stepResults.set(n,s)},2(t,e){const[n,s]=t.message(fo);e.stepErrors.set(n,s)}},co={default(){return[0,De.default()]},1(t,e){e[0]=t.uint32()},2(t,e){e[1]=t.message(De)}},fo={default(){return[0,ae.default()]},1(t,e){e[0]=t.uint32()},2(t,e){e[1]=t.message(ae)}},bs={default(){return{type:"none"}},1(t){return t.message(ho)},2(t){return t.message(po)},3(t){return t.message(mo)},4(t){return{type:"row",row:t.message(ws)}},5(t){return{type:"error",error:t.message(ae)}}},ho={default(){return{type:"step_begin",step:0,cols:[]}},1(t,e){e.step=t.uint32()},2(t,e){e.cols.push(t.message(ys))}},po={default(){return{type:"step_end",affectedRowCount:0,lastInsertRowid:void 0}},1(t,e){e.affectedRowCount=t.uint32()},2(t,e){e.lastInsertRowid=t.uint64()}},mo={default(){return{type:"step_error",step:0,error:ae.default()}},1(t,e){e.step=t.uint32()},2(t,e){e.error=t.message(ae)}},it={default(){return{params:[],cols:[],isExplain:!1,isReadonly:!1}},1(t,e){e.params.push(t.message(yo))},2(t,e){e.cols.push(t.message(wo))},3(t,e){e.isExplain=t.bool()},4(t,e){e.isReadonly=t.bool()}},yo={default(){return{name:void 0}},1(t,e){e.name=t.string()}},wo={default(){return{name:"",decltype:void 0}},1(t,e){e.name=t.string()},2(t,e){e.decltype=t.string()}},bo={default(){},1(t){return null},2(t){return t.sint64()},3(t){return t.double()},4(t){return t.string()},5(t){return t.bytes()}},go={default(){return{type:"none"}},1(t){return{type:"hello_ok"}},2(t){return t.message(vo)},3(t){return t.message(So)},4(t){return t.message(_o)}},vo={default(){return{type:"hello_error",error:ae.default()}},1(t,e){e.error=t.message(ae)}},_o={default(){return{type:"response_error",requestId:0,error:ae.default()}},1(t,e){e.requestId=t.int32()},2(t,e){e.error=t.message(ae)}},So={default(){return{type:"response_ok",requestId:0,response:{type:"none"}}},1(t,e){e.requestId=t.int32()},2(t,e){e.response={type:"open_stream"}},3(t,e){e.response={type:"close_stream"}},4(t,e){e.response=t.message(xo)},5(t,e){e.response=t.message(Ro)},6(t,e){e.response={type:"open_cursor"}},7(t,e){e.response={type:"close_cursor"}},8(t,e){e.response=t.message(qo)},9(t,e){e.response={type:"sequence"}},10(t,e){e.response=t.message(Co)},11(t,e){e.response={type:"store_sql"}},12(t,e){e.response={type:"close_sql"}},13(t,e){e.response=t.message(Io)}},xo={default(){return{type:"execute",result:De.default()}},1(t,e){e.result=t.message(De)}},Ro={default(){return{type:"batch",result:ot.default()}},1(t,e){e.result=t.message(ot)}},qo={default(){return{type:"fetch_cursor",entries:[],done:!1}},1(t,e){e.entries.push(t.message(bs))},2(t,e){e.done=t.bool()}},Co={default(){return{type:"describe",result:it.default()}},1(t,e){e.result=t.message(it)}},Io={default(){return{type:"get_autocommit",isAutocommit:!1}},1(t,e){e.isAutocommit=t.bool()}},To=new Map([["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]),gs=new Map([["hrana3-protobuf",{version:3,encoding:"protobuf"}],["hrana3",{version:3,encoding:"json"}],["hrana2",{version:2,encoding:"json"}],["hrana1",{version:1,encoding:"json"}]]);let $o=class extends Yn{#e;#t;#n;#s;#o;#r;#a;#i;#l;_streamIdAlloc;_cursorIdAlloc;#u;constructor(e,n){super(),this.#e=e,this.#t=[],this.#n=!1,this.#s=void 0,this.#o=!1,this.#r=void 0,this.#a=!1,this.#i=new Map,this.#l=new je,this._streamIdAlloc=new je,this._cursorIdAlloc=new je,this.#u=new je,this.#e.binaryType="arraybuffer",this.#e.addEventListener("open",()=>this.#p()),this.#e.addEventListener("close",s=>this.#h(s)),this.#e.addEventListener("error",s=>this.#m(s)),this.#e.addEventListener("message",s=>this.#w(s)),this.#d({type:"hello",jwt:n})}#d(e){if(this.#s!==void 0)throw new ce("Trying to send a message on a closed client");if(this.#n)this.#f(e);else{const n=()=>this.#f(e),s=()=>{};this.#t.push({openCallback:n,errorCallback:s})}}#p(){const e=this.#e.protocol;if(e===void 0){this.#c(new U("The `WebSocket.protocol` property is undefined. This most likely means that the WebSocket implementation provided by the environment is broken. If you are using Miniflare 2, please update to Miniflare 3, which fixes this problem."));return}else if(e==="")this.#r={version:1,encoding:"json"};else if(this.#r=gs.get(e),this.#r===void 0){this.#c(new g(`Unrecognized WebSocket subprotocol: ${JSON.stringify(e)}`));return}for(const n of this.#t)n.openCallback();this.#t.length=0,this.#n=!0}#f(e){const n=this.#r.encoding;if(n==="json"){const s=Kn(e,jr);this.#e.send(s)}else if(n==="protobuf"){const s=Xn(e,zr);this.#e.send(s)}else throw B(n,"Impossible encoding")}getVersion(){return new Promise((e,n)=>{if(this.#a=!0,this.#s!==void 0)n(this.#s);else if(this.#n)e(this.#r.version);else{const s=()=>e(this.#r.version);this.#t.push({openCallback:s,errorCallback:n})}})}_ensureVersion(e,n){if(this.#r===void 0||!this.#a)throw new Ae(`${n} is supported only on protocol version ${e} and higher, but the version supported by the WebSocket server is not yet known. Use Client.getVersion() to wait until the version is available.`);if(this.#r.version<e)throw new Ae(`${n} is supported on protocol version ${e} and higher, but the WebSocket server only supports version ${this.#r.version}`)}_sendRequest(e,n){if(this.#s!==void 0){n.errorCallback(new ee("Client is closed",this.#s));return}const s=this.#l.alloc();this.#i.set(s,{...n,type:e.type}),this.#d({type:"request",requestId:s,request:e})}#m(e){const s=e.message??"WebSocket was closed due to an error";this.#c(new _t(s))}#h(e){let n=`WebSocket was closed with code ${e.code}`;e.reason&&(n+=`: ${e.reason}`),this.#c(new _t(n))}#c(e){if(this.#s===void 0){this.#s=e;for(const n of this.#t)n.errorCallback(e);this.#t.length=0;for(const[n,s]of this.#i.entries())s.errorCallback(e),this.#l.free(n);this.#i.clear(),this.#e.close()}}#w(e){if(this.#s===void 0)try{let n;const s=this.#r.encoding;if(s==="json"){if(typeof e.data!="string"){this.#e.close(3003,"Only text messages are accepted with JSON encoding"),this.#c(new g("Received non-text message from server with JSON encoding"));return}n=Dt(JSON.parse(e.data),lo)}else if(s==="protobuf"){if(!(e.data instanceof ArrayBuffer)){this.#e.close(3003,"Only binary messages are accepted with Protobuf encoding"),this.#c(new g("Received non-binary message from server with Protobuf encoding"));return}n=ct(new Uint8Array(e.data),go)}else throw B(s,"Impossible encoding");this.#y(n)}catch(n){this.#e.close(3007,"Could not handle message"),this.#c(n)}}#y(e){if(e.type==="none")throw new g("Received an unrecognized ServerMsg");if(e.type==="hello_ok"||e.type==="hello_error"){if(this.#o)throw new g("Received a duplicated hello response");if(this.#o=!0,e.type==="hello_error")throw Ee(e.error);return}else if(!this.#o)throw new g("Received a non-hello message before a hello response");if(e.type==="response_ok"){const n=e.requestId,s=this.#i.get(n);if(this.#i.delete(n),s===void 0)throw new g("Received unexpected OK response");this.#l.free(n);try{if(s.type!==e.response.type)throw console.dir({responseState:s,msg:e}),new g("Received unexpected type of response");s.responseCallback(e.response)}catch(r){throw s.errorCallback(r),r}}else if(e.type==="response_error"){const n=e.requestId,s=this.#i.get(n);if(this.#i.delete(n),s===void 0)throw new g("Received unexpected error response");this.#l.free(n),s.errorCallback(Ee(e.error))}else throw B(e,"Impossible ServerMsg type")}openStream(){return Ut.open(this)}storeSql(e){this._ensureVersion(2,"storeSql()");const n=this.#u.alloc(),s=new Ot(this,n),r=()=>{},o=a=>s._setClosed(a),i={type:"store_sql",sqlId:n,sql:e};return this._sendRequest(i,{responseCallback:r,errorCallback:o}),s}_closeSql(e){if(this.#s!==void 0)return;const n=()=>this.#u.free(e),s=o=>this.#c(o),r={type:"close_sql",sqlId:e};this._sendRequest(r,{responseCallback:n,errorCallback:s})}close(){this.#c(new U("Client was manually closed"))}get closed(){return this.#s!==void 0}};const Ao=fetch,vs=Request,Eo=Headers;let Te;if(typeof queueMicrotask<"u")Te=queueMicrotask;else{const t=Promise.resolve();Te=e=>{t.then(e)}}class Po{#e;#t;#n;constructor(e){this.#e=new Uint8Array(new ArrayBuffer(e)),this.#t=0,this.#n=0}get length(){return this.#n-this.#t}data(){return this.#e.slice(this.#t,this.#n)}push(e){this.#s(e.byteLength),this.#e.set(e,this.#n),this.#n+=e.byteLength}#s(e){if(this.#n+e<=this.#e.byteLength)return;const n=this.#n-this.#t;if(n+e<=this.#e.byteLength&&2*this.#n>=this.#e.byteLength)this.#e.copyWithin(0,this.#t,this.#n);else{let s=this.#e.byteLength;do s*=2;while(n+e>s);const r=new Uint8Array(new ArrayBuffer(s));r.set(this.#e.slice(this.#t,this.#n),0),this.#e=r}this.#n=n,this.#t=0}shift(e){this.#t+=e}}function Do(t){const e=re(t.baton),n=re(t.base_url),s=de(t.results,ko);return{baton:e,baseUrl:n,results:s}}function ko(t){const e=se(t.type);if(e==="ok")return{type:"ok",response:Oo(z(t.response))};if(e==="error")return{type:"error",error:Pe(z(t.error))};throw new g("Unexpected type of StreamResult")}function Oo(t){const e=se(t.type);if(e==="close")return{type:"close"};if(e==="execute")return{type:"execute",result:Lt(z(t.result))};if(e==="batch")return{type:"batch",result:fs(z(t.result))};if(e==="sequence")return{type:"sequence"};if(e==="describe")return{type:"describe",result:ps(z(t.result))};if(e==="store_sql")return{type:"store_sql"};if(e==="close_sql")return{type:"close_sql"};if(e==="get_autocommit")return{type:"get_autocommit",isAutocommit:ze(t.is_autocommit)};throw new g("Unexpected type of StreamResponse")}function Uo(t){const e=re(t.baton),n=re(t.base_url);return{baton:e,baseUrl:n}}const Mo={default(){return{baton:void 0,baseUrl:void 0,results:[]}},1(t,e){e.baton=t.string()},2(t,e){e.baseUrl=t.string()},3(t,e){e.results.push(t.message(No))}},No={default(){return{type:"none"}},1(t){return{type:"ok",response:t.message(Bo)}},2(t){return{type:"error",error:t.message(ae)}}},Bo={default(){return{type:"none"}},1(t){return{type:"close"}},2(t){return t.message(Lo)},3(t){return t.message(jo)},4(t){return{type:"sequence"}},5(t){return t.message(Fo)},6(t){return{type:"store_sql"}},7(t){return{type:"close_sql"}},8(t){return t.message(Ho)}},Lo={default(){return{type:"execute",result:De.default()}},1(t,e){e.result=t.message(De)}},jo={default(){return{type:"batch",result:ot.default()}},1(t,e){e.result=t.message(ot)}},Fo={default(){return{type:"describe",result:it.default()}},1(t,e){e.result=t.message(it)}},Ho={default(){return{type:"get_autocommit",isAutocommit:!1}},1(t,e){e.isAutocommit=t.bool()}},Vo={default(){return{baton:void 0,baseUrl:void 0}},1(t,e){e.baton=t.string()},2(t,e){e.baseUrl=t.string()}};class zo extends as{#e;#t;#n;#s;#o;#r;constructor(e,n){super(),this.#e=e,this.#t=n,this.#n=void 0,this.#s=new Po(16*1024),this.#o=void 0,this.#r=!1}async open(e){if(e.body===null)throw new g("No response body for cursor request");this.#n=e.body.getReader();const n=await this.#a(Uo,Vo);if(n===void 0)throw new g("Empty response to cursor request");return n}next(){return this.#a(hs,bs)}close(){this._setClosed(new U("Cursor was manually closed"))}_setClosed(e){this.#o===void 0&&(this.#o=e,this.#e._cursorClosed(this),this.#n!==void 0&&this.#n.cancel())}get closed(){return this.#o!==void 0}async#a(e,n){for(;;){if(this.#r)return;if(this.#o!==void 0)throw new ee("Cursor is closed",this.#o);if(this.#t==="json"){const o=this.#i();if(o!==void 0){const i=new TextDecoder().decode(o),a=JSON.parse(i);return Dt(a,e)}}else if(this.#t==="protobuf"){const o=this.#l();if(o!==void 0)return ct(o,n)}else throw B(this.#t,"Impossible encoding");if(this.#n===void 0)throw new ce("Attempted to read from HTTP cursor before it was opened");const{value:s,done:r}=await this.#n.read();if(r&&this.#s.length===0)this.#r=!0;else{if(r)throw new g("Unexpected end of cursor stream");this.#s.push(s)}}}#i(){const e=this.#s.data(),s=e.indexOf(10);if(s<0)return;const r=e.slice(0,s);return this.#s.shift(s+1),r}#l(){const e=this.#s.data();let n=0,s=0;for(;;){if(s>=e.byteLength)return;const o=e[s];if(n|=(o&127)<<7*s,s+=1,!(o&128))break}if(e.byteLength<s+n)return;const r=e.slice(s,s+n);return this.#s.shift(s+n),r}}function Zo(t,e){e.baton!==void 0&&t.string("baton",e.baton),t.arrayObjects("requests",e.requests,Wo)}function Wo(t,e){if(t.stringRaw("type",e.type),e.type!=="close"){if(e.type==="execute")t.object("stmt",e.stmt,Mt);else if(e.type==="batch")t.object("batch",e.batch,rt);else if(e.type==="sequence")e.sql!==void 0&&t.string("sql",e.sql),e.sqlId!==void 0&&t.number("sql_id",e.sqlId);else if(e.type==="describe")e.sql!==void 0&&t.string("sql",e.sql),e.sqlId!==void 0&&t.number("sql_id",e.sqlId);else if(e.type==="store_sql")t.number("sql_id",e.sqlId),t.string("sql",e.sql);else if(e.type==="close_sql")t.number("sql_id",e.sqlId);else if(e.type!=="get_autocommit")throw B(e,"Impossible type of StreamRequest")}}function Yo(t,e){e.baton!==void 0&&t.string("baton",e.baton),t.object("batch",e.batch,rt)}function Qo(t,e){e.baton!==void 0&&t.string(1,e.baton);for(const n of e.requests)t.message(2,n,Go)}function Go(t,e){if(e.type==="close")t.message(1,e,Jo);else if(e.type==="execute")t.message(2,e,Ko);else if(e.type==="batch")t.message(3,e,Xo);else if(e.type==="sequence")t.message(4,e,ei);else if(e.type==="describe")t.message(5,e,ti);else if(e.type==="store_sql")t.message(6,e,ni);else if(e.type==="close_sql")t.message(7,e,si);else if(e.type==="get_autocommit")t.message(8,e,ri);else throw B(e,"Impossible type of StreamRequest")}function Jo(t,e){}function Ko(t,e){t.message(1,e.stmt,Nt)}function Xo(t,e){t.message(1,e.batch,dt)}function ei(t,e){e.sql!==void 0&&t.string(1,e.sql),e.sqlId!==void 0&&t.int32(2,e.sqlId)}function ti(t,e){e.sql!==void 0&&t.string(1,e.sql),e.sqlId!==void 0&&t.int32(2,e.sqlId)}function ni(t,e){t.int32(1,e.sqlId),t.string(2,e.sql)}function si(t,e){t.int32(1,e.sqlId)}function ri(t,e){}function oi(t,e){e.baton!==void 0&&t.string(1,e.baton),t.message(2,e.batch,dt)}class ii extends is{#e;#t;#n;#s;#o;#r;#a;#i;#l;#u;#d;#p;constructor(e,n,s,r){super(e.intMode),this.#e=e,this.#t=n.toString(),this.#n=s,this.#s=r,this.#o=void 0,this.#r=new st,this.#a=!1,this.#l=!1,this.#u=!1,this.#d=void 0,this.#p=new je}client(){return this.#e}_sqlOwner(){return this}storeSql(e){const n=this.#p.alloc();return this.#f({type:"store_sql",sqlId:n,sql:e}).then(()=>{},s=>this._setClosed(s)),new Ot(this,n)}_closeSql(e){this.#d===void 0&&this.#f({type:"close_sql",sqlId:e}).then(()=>this.#p.free(e),n=>this._setClosed(n))}_execute(e){return this.#f({type:"execute",stmt:e}).then(n=>n.result)}_batch(e){return this.#f({type:"batch",batch:e}).then(n=>n.result)}_describe(e){return this.#f({type:"describe",sql:e.sql,sqlId:e.sqlId}).then(n=>n.result)}_sequence(e){return this.#f({type:"sequence",sql:e.sql,sqlId:e.sqlId}).then(n=>{})}getAutocommit(){return this.#e._ensureVersion(3,"getAutocommit()"),this.#f({type:"get_autocommit"}).then(e=>e.isAutocommit)}#f(e){return new Promise((n,s)=>{this.#m({type:"pipeline",request:e,responseCallback:n,errorCallback:s})})}_openCursor(e){return new Promise((n,s)=>{this.#m({type:"cursor",batch:e,cursorCallback:n,errorCallback:s})})}_cursorClosed(e){if(e!==this.#i)throw new ce("Cursor was closed, but it was not associated with the stream");this.#i=void 0,Te(()=>this.#h())}close(){this._setClosed(new U("Stream was manually closed"))}closeGracefully(){this.#l=!0,Te(()=>this.#h())}get closed(){return this.#d!==void 0||this.#l}_setClosed(e){if(this.#d===void 0){for(this.#d=e,this.#i!==void 0&&this.#i._setClosed(e),this.#e._streamClosed(this);;){const n=this.#r.shift();if(n!==void 0)n.errorCallback(e);else break}(this.#o!==void 0||this.#a)&&!this.#u&&(this.#r.push({type:"pipeline",request:{type:"close"},responseCallback:()=>{},errorCallback:()=>{}}),this.#u=!0,Te(()=>this.#h()))}}#m(e){if(this.#d!==void 0)throw new ee("Stream is closed",this.#d);if(this.#l)throw new ee("Stream is closing",void 0);this.#r.push(e),Te(()=>this.#h())}#h(){if(this.#a||this.#i!==void 0)return;if(this.#l&&this.#r.length===0){this._setClosed(new U("Stream was gracefully closed"));return}const e=this.#e._endpoint;if(e===void 0){this.#e._endpointPromise.then(()=>this.#h(),s=>this._setClosed(s));return}const n=this.#r.shift();if(n!==void 0)if(n.type==="pipeline"){const s=[n];for(;;){const r=this.#r.first();if(r!==void 0&&r.type==="pipeline")s.push(r),this.#r.shift();else if(r===void 0&&this.#l&&!this.#u){s.push({type:"pipeline",request:{type:"close"},responseCallback:()=>{},errorCallback:()=>{}}),this.#u=!0;break}else break}this.#c(e,s)}else if(n.type==="cursor")this.#w(e,n);else throw B(n,"Impossible type of QueueEntry")}#c(e,n){this.#y(()=>this.#g(n,e),s=>li(s,e.encoding),s=>s.baton,s=>s.baseUrl,s=>ai(n,s),s=>n.forEach(r=>r.errorCallback(s)))}#w(e,n){const s=new zo(this,e.encoding);this.#i=s,this.#y(()=>this.#v(n,e),r=>s.open(r),r=>r.baton,r=>r.baseUrl,r=>n.cursorCallback(s),r=>n.errorCallback(r))}#y(e,n,s,r,o,i){let a;try{const l=e(),c=this.#s;a=c(l)}catch(l){a=Promise.reject(l)}this.#a=!0,a.then(l=>l.ok?n(l):ui(l).then(c=>{throw c})).then(l=>{this.#o=s(l),this.#t=r(l)??this.#t,o(l)}).catch(l=>{this._setClosed(l),i(l)}).finally(()=>{this.#a=!1,this.#h()})}#g(e,n){return this.#b(new URL(n.pipelinePath,this.#t),{baton:this.#o,requests:e.map(s=>s.request)},n.encoding,Zo,Qo)}#v(e,n){if(n.cursorPath===void 0)throw new Ae(`Cursors are supported only on protocol version 3 and higher, but the HTTP server only supports version ${n.version}.`);return this.#b(new URL(n.cursorPath,this.#t),{baton:this.#o,batch:e.batch},n.encoding,Yo,oi)}#b(e,n,s,r,o){let i,a;if(s==="json")i=Kn(n,r),a="application/json";else if(s==="protobuf")i=Xn(n,o),a="application/x-protobuf";else throw B(s,"Impossible encoding");const l=new Eo;return l.set("content-type",a),this.#n!==void 0&&l.set("authorization",`Bearer ${this.#n}`),new vs(e.toString(),{method:"POST",headers:l,body:i})}}function ai(t,e){if(e.results.length!==t.length)throw new g("Server returned unexpected number of pipeline results");for(let n=0;n<t.length;++n){const s=e.results[n],r=t[n];if(s.type==="ok"){if(s.response.type!==r.request.type)throw new g("Received unexpected type of response");r.responseCallback(s.response)}else if(s.type==="error")r.errorCallback(Ee(s.error));else throw s.type==="none"?new g("Received unrecognized type of StreamResult"):B(s,"Received impossible type of StreamResult")}}async function li(t,e){if(e==="json"){const n=await t.json();return Dt(n,Do)}else if(e==="protobuf"){const n=await t.arrayBuffer();return ct(new Uint8Array(n),Mo)}else throw B(e,"Impossible encoding")}async function ui(t){const e=t.headers.get("content-type")??"text/plain";if(e==="application/json"){const s=await t.json();if("message"in s)return Ee(s)}let n=`Server returned HTTP status ${t.status}`;if(e==="text/plain"){const s=(await t.text()).trim();s!==""&&(n+=`: ${s}`)}return new Jn(n,t.status)}const ci=[{versionPath:"v3-protobuf",pipelinePath:"v3-protobuf/pipeline",cursorPath:"v3-protobuf/cursor",version:3,encoding:"protobuf"}],It={versionPath:"v2",pipelinePath:"v2/pipeline",cursorPath:void 0,version:2,encoding:"json"};let di=class extends Yn{#e;#t;#n;#s;#o;_endpointPromise;_endpoint;constructor(e,n,s,r=2){super(),this.#e=e,this.#t=n,this.#n=s??Ao,this.#s=void 0,this.#o=new Set,r==3?(this._endpointPromise=fi(this.#n,this.#e),this._endpointPromise.then(o=>this._endpoint=o,o=>this.#r(o))):(this._endpointPromise=Promise.resolve(It),this._endpointPromise.then(o=>this._endpoint=o,o=>this.#r(o)))}async getVersion(){return this._endpoint!==void 0?this._endpoint.version:(await this._endpointPromise).version}_ensureVersion(e,n){if(!(e<=It.version)){if(this._endpoint===void 0)throw new Ae(`${n} is supported only on protocol version ${e} and higher, but the version supported by the HTTP server is not yet known. Use Client.getVersion() to wait until the version is available.`);if(this._endpoint.version<e)throw new Ae(`${n} is supported only on protocol version ${e} and higher, but the HTTP server only supports version ${this._endpoint.version}.`)}}openStream(){if(this.#s!==void 0)throw new ee("Client is closed",this.#s);const e=new ii(this,this.#e,this.#t,this.#n);return this.#o.add(e),e}_streamClosed(e){this.#o.delete(e)}close(){this.#r(new U("Client was manually closed"))}get closed(){return this.#s!==void 0}#r(e){if(this.#s===void 0){this.#s=e;for(const n of Array.from(this.#o))n._setClosed(new ee("Client was closed",e))}}};async function fi(t,e){const n=t;for(const s of ci){const r=new URL(s.versionPath,e),o=new vs(r.toString(),{method:"GET"}),i=await n(o);if(await i.arrayBuffer(),i.ok)return s}return It}function _s(t,e,n=2){if(typeof Ie>"u")throw new Gn("WebSockets are not supported in this environment");var s=void 0;n==3?s=Array.from(gs.keys()):s=Array.from(To.keys());const r=new Ie(t,s);return new $o(r,e)}function hi(t,e,n,s=2){return new di(t instanceof URL?t:new URL(t),e,n,s)}class Ss{#e;#t;#n;constructor(e,n){this.#e=e,this.#t=n,this.#n=void 0}execute(e){return this.batch([e]).then(n=>n[0])}async batch(e){const n=this._getStream();if(n.closed)throw new T("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{const s=e.map(ge);let r;if(this.#n===void 0){this._getSqlCache().apply(s);const i=n.batch(this.#t>=3),a=i.step(),l=a.run(vt(this.#e));let c=a;r=s.map(u=>{const f=i.step().condition(K.ok(c));this.#t>=3&&f.condition(K.not(K.isAutocommit(i)));const y=f.query(u);return y.catch(()=>{}),c=f,y}),this.#n=i.execute().then(()=>l).then(()=>{});try{await this.#n}catch(u){throw this.close(),u}}else{this.#t<3&&await this.#n,this._getSqlCache().apply(s);const i=n.batch(this.#t>=3);let a;r=s.map(l=>{const c=i.step();a!==void 0&&c.condition(K.ok(a)),this.#t>=3&&c.condition(K.not(K.isAutocommit(i)));const u=c.query(l);return u.catch(()=>{}),a=c,u}),await i.execute()}const o=[];for(const i of r){const a=await i;if(a===void 0)throw new T("Statement in a transaction was not executed, probably because the transaction has been rolled back","TRANSACTION_CLOSED");o.push(ft(a))}return o}catch(s){throw N(s)}}async executeMultiple(e){const n=this._getStream();if(n.closed)throw new T("Cannot execute statements because the transaction is closed","TRANSACTION_CLOSED");try{if(this.#n===void 0){this.#n=n.run(vt(this.#e)).then(()=>{});try{await this.#n}catch(s){throw this.close(),s}}else await this.#n;await n.sequence(e)}catch(s){throw N(s)}}async rollback(){try{const e=this._getStream();if(e.closed||this.#n===void 0)return;const n=e.run("ROLLBACK").catch(s=>{throw N(s)});e.closeGracefully(),await n}catch(e){throw N(e)}finally{this.close()}}async commit(){try{const e=this._getStream();if(e.closed)throw new T("Cannot commit the transaction because it is already closed","TRANSACTION_CLOSED");if(this.#n!==void 0)await this.#n;else return;const n=e.run("COMMIT").catch(s=>{throw N(s)});e.closeGracefully(),await n}catch(e){throw N(e)}finally{this.close()}}}async function at(t,e,n,s,r=!1){r&&n.step().run("PRAGMA foreign_keys=off");const o=n.step(),i=o.run(vt(t));let a=o;const l=s.map(m=>{const h=n.step().condition(K.ok(a));e>=3&&h.condition(K.not(K.isAutocommit(n)));const d=h.query(m);return a=h,d}),c=n.step().condition(K.ok(a));e>=3&&c.condition(K.not(K.isAutocommit(n)));const u=c.run("COMMIT");n.step().condition(K.not(K.ok(c))).run("ROLLBACK").catch(m=>{}),r&&n.step().run("PRAGMA foreign_keys=on"),await n.execute();const y=[];await i;for(const m of l){const h=await m;if(h===void 0)throw new T("Statement in a batch was not executed, probably because the transaction has been rolled back","TRANSACTION_CLOSED");y.push(ft(h))}return await u,y}function ge(t){if(typeof t=="string")return new qt(t);const e=new qt(t.sql);if(Array.isArray(t.args))e.bindIndexes(t.args);else for(const[n,s]of Object.entries(t.args))e.bindName(n,s);return e}function ft(t){const e=t.columnNames.map(i=>i??""),n=t.columnDecltypes.map(i=>i??""),s=t.rows,r=t.affectedRowCount,o=t.lastInsertRowid!==void 0?t.lastInsertRowid:void 0;return new _r(e,n,s,r,o)}function N(t){if(t instanceof U){const e=xs(t);return new T(t.message,e,void 0,t)}return t}function xs(t){return t instanceof Qn&&t.code!==void 0?t.code:t instanceof g?"HRANA_PROTO_ERROR":t instanceof ee?t.cause instanceof U?xs(t.cause):"HRANA_CLOSED_ERROR":t instanceof _t?"HRANA_WEBSOCKET_ERROR":t instanceof Jn?"SERVER_ERROR":t instanceof Ae?"PROTOCOL_VERSION_ERROR":t instanceof ce?"INTERNAL_ERROR":"UNKNOWN"}class jt{#e;#t;capacity;constructor(e,n){this.#e=e,this.#t=new pi,this.capacity=n}apply(e){if(this.capacity<=0)return;const n=new Set;for(const s of e){if(typeof s.sql!="string")continue;const r=s.sql;if(r.length>=5e3)continue;let o=this.#t.get(r);if(o===void 0){for(;this.#t.size+1>this.capacity;){const[i,a]=this.#t.peekLru();if(n.has(a))break;a.close(),this.#t.delete(i)}this.#t.size+1<=this.capacity&&(o=this.#e.storeSql(r),this.#t.set(r,o))}o!==void 0&&(s.sql=o,n.add(o))}}}class pi{#e;constructor(){this.#e=new Map}get(e){const n=this.#e.get(e);return n!==void 0&&(this.#e.delete(e),this.#e.set(e,n)),n}set(e,n){this.#e.set(e,n)}peekLru(){for(const e of this.#e.entries())return e}delete(e){this.#e.delete(e)}get size(){return this.#e.size}}function mi(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function yi(t){var e=0,n=[];function s(){e--,e<t&&r()}function r(){var l=n.shift();a.queue=n.length,l&&i(l.fn).then(l.resolve).catch(l.reject)}function o(l){return new Promise(function(c,u){n.push({fn:l,resolve:c,reject:u}),a.queue=n.length})}function i(l){e++;try{return Promise.resolve(l()).then(function(c){return s(),c},function(c){throw s(),c})}catch(c){return s(),Promise.reject(c)}}var a=function(l){return e>=t?o(l):i(l)};return a}function wi(t,e){var n=!1,s=this;return Promise.all(t.map(function(){var r=arguments;return s(function(){if(!n)return e.apply(void 0,r).catch(function(o){throw n=!0,o})})}))}function un(t){return t.queue=0,t.map=wi,t}var bi=function(t){return un(t?yi(t):function(e){return e()})};const Rs=mi(bi);function gi(t){if(t.scheme!=="wss"&&t.scheme!=="ws")throw new T(`The WebSocket client supports only "libsql:", "wss:" and "ws:" URLs, got ${JSON.stringify(t.scheme+":")}. For more information, please read ${Ve}`,"URL_SCHEME_NOT_SUPPORTED");if(t.encryptionKey!==void 0)throw new T("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if(t.scheme==="ws"&&t.tls)throw new T('A "ws:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");if(t.scheme==="wss"&&!t.tls)throw new T('A "wss:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");const e=wt(t.scheme,t.authority,t.path);let n;try{n=_s(e,t.authToken)}catch(s){if(s instanceof Gn){const r=t.scheme==="wss"?"https":"http",o=wt(r,t.authority,t.path);throw new T(`This environment does not support WebSockets, please switch to the HTTP client by using a "${r}:" URL (${JSON.stringify(o)}). For more information, please read ${Ve}`,"WEBSOCKETS_NOT_SUPPORTED")}throw N(s)}return new Si(n,e,t.authToken,t.intMode,t.concurrency)}const vi=60*1e3,_i=100;class Si{#e;#t;#n;#s;#o;closed;protocol;#r;#a;constructor(e,n,s,r,o){this.#e=n,this.#t=s,this.#n=r,this.#s=this.#l(e),this.#o=void 0,this.closed=!1,this.protocol="ws",this.#a=Rs(o)}async limit(e){return this.#a(e)}async execute(e,n){let s;return typeof e=="string"?s={sql:e,args:n||[]}:s=e,this.limit(async()=>{const r=await this.#i();try{const o=ge(s);r.conn.sqlCache.apply([o]);const i=r.stream.query(o);r.stream.closeGracefully();const a=await i;return ft(a)}catch(o){throw N(o)}finally{this._closeStream(r)}})}async batch(e,n="deferred"){return this.limit(async()=>{const s=await this.#i();try{const r=e.map(ge),o=await s.conn.client.getVersion();s.conn.sqlCache.apply(r);const i=s.stream.batch(o>=3);return await at(n,o,i,r)}catch(r){throw N(r)}finally{this._closeStream(s)}})}async migrate(e){return this.limit(async()=>{const n=await this.#i();try{const s=e.map(ge),r=await n.conn.client.getVersion(),o=n.stream.batch(r>=3);return await at("deferred",r,o,s,!0)}catch(s){throw N(s)}finally{this._closeStream(n)}})}async transaction(e="write"){return this.limit(async()=>{const n=await this.#i();try{const s=await n.conn.client.getVersion();return new xi(this,n,e,s)}catch(s){throw this._closeStream(n),N(s)}})}async executeMultiple(e){return this.limit(async()=>{const n=await this.#i();try{const s=n.stream.sequence(e);n.stream.closeGracefully(),await s}catch(s){throw N(s)}finally{this._closeStream(n)}})}sync(){throw new T("sync not supported in ws mode","SYNC_NOT_SUPPORTED")}async#i(){if(this.closed)throw new T("The client is closed","CLIENT_CLOSED");if(new Date().valueOf()-this.#s.openTime.valueOf()>vi&&this.#o===void 0){const r=this.#l();this.#o=r,r.client.getVersion().then(o=>{this.#s!==r&&this.#s.streamStates.size===0&&this.#s.client.close(),this.#s=r,this.#o=void 0},o=>{this.#o=void 0})}if(this.#s.client.closed)try{this.#o!==void 0?this.#s=this.#o:this.#s=this.#l()}catch(r){throw N(r)}const s=this.#s;try{s.useSqlCache===void 0&&(s.useSqlCache=await s.client.getVersion()>=2,s.useSqlCache&&(s.sqlCache.capacity=_i));const r=s.client.openStream();r.intMode=this.#n;const o={conn:s,stream:r};return s.streamStates.add(o),o}catch(r){throw N(r)}}#l(e){try{return e??=_s(this.#e,this.#t),{client:e,useSqlCache:void 0,sqlCache:new jt(e,0),openTime:new Date,streamStates:new Set}}catch(n){throw N(n)}}_closeStream(e){e.stream.close();const n=e.conn;n.streamStates.delete(e),n.streamStates.size===0&&n!==this.#s&&n.client.close()}close(){this.#s.client.close(),this.closed=!0}}class xi extends Ss{#e;#t;constructor(e,n,s,r){super(s,r),this.#e=e,this.#t=n}_getStream(){return this.#t.stream}_getSqlCache(){return this.#t.conn.sqlCache}close(){this.#e._closeStream(this.#t)}get closed(){return this.#t.stream.closed}}function Ri(t){if(t.scheme!=="https"&&t.scheme!=="http")throw new T(`The HTTP client supports only "libsql:", "https:" and "http:" URLs, got ${JSON.stringify(t.scheme+":")}. For more information, please read ${Ve}`,"URL_SCHEME_NOT_SUPPORTED");if(t.encryptionKey!==void 0)throw new T("Encryption key is not supported by the remote client.","ENCRYPTION_KEY_NOT_SUPPORTED");if(t.scheme==="http"&&t.tls)throw new T('A "http:" URL cannot opt into TLS by using ?tls=1',"URL_INVALID");if(t.scheme==="https"&&!t.tls)throw new T('A "https:" URL cannot opt out of TLS by using ?tls=0',"URL_INVALID");const e=wt(t.scheme,t.authority,t.path);return new qi(e,t.authToken,t.intMode,t.fetch,t.concurrency)}const qs=30;class qi{#e;protocol;#t;#n;constructor(e,n,s,r,o){this.#e=hi(e,n,r),this.#e.intMode=s,this.protocol="http",this.#t=n,this.#n=Rs(o)}async limit(e){return this.#n(e)}async execute(e,n){let s;return typeof e=="string"?s={sql:e,args:n||[]}:s=e,this.limit(async()=>{try{const r=ge(s);let o;const i=this.#e.openStream();try{o=i.query(r)}finally{i.closeGracefully()}const a=await o;return ft(a)}catch(r){throw N(r)}})}async batch(e,n="deferred"){return this.limit(async()=>{try{const s=e.map(ge),r=await this.#e.getVersion();let o;const i=this.#e.openStream();try{new jt(i,qs).apply(s);const c=i.batch(!1);o=at(n,r,c,s)}finally{i.closeGracefully()}return await o}catch(s){throw N(s)}})}async migrate(e){return this.limit(async()=>{try{const n=e.map(ge),s=await this.#e.getVersion();let r;const o=this.#e.openStream();try{const a=o.batch(!1);r=at("deferred",s,a,n,!0)}finally{o.closeGracefully()}return await r}catch(n){throw N(n)}})}async transaction(e="write"){return this.limit(async()=>{try{const n=await this.#e.getVersion();return new Ci(this.#e.openStream(),e,n)}catch(n){throw N(n)}})}async executeMultiple(e){return this.limit(async()=>{try{let n;const s=this.#e.openStream();try{n=s.sequence(e)}finally{s.closeGracefully()}await n}catch(n){throw N(n)}})}sync(){throw new T("sync not supported in http mode","SYNC_NOT_SUPPORTED")}close(){this.#e.close()}get closed(){return this.#e.closed}}class Ci extends Ss{#e;#t;constructor(e,n,s){super(n,s),this.#e=e,this.#t=new jt(e,qs)}_getStream(){return this.#e}_getSqlCache(){return this.#t}close(){this.#e.close()}get closed(){return this.#e.closed}}function Ii(t){return Ti(Rr(t))}function Ti(t){if(t.scheme==="ws"||t.scheme==="wss")return gi(t);if(t.scheme==="http"||t.scheme==="https")return Ri(t);throw new T(`The client that uses Web standard APIs supports only "libsql:", "wss:", "ws:", "https:" and "http:" URLs, got ${JSON.stringify(t.scheme+":")}. For more information, please read ${Ve}`,"URL_SCHEME_NOT_SUPPORTED")}const ht=Ii({url:"libsql://questions-jesuskor.turso.io",authToken:"eyJhbGciOiJFZERTQSIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3MjU0MjU2NDgsImlkIjoiYjQ4NjYzNzUtNTVlMC00YmJkLTgyZjEtY2NhOWMyMWNhMTk4In0.5tOVQrSfGgWIUsqUHTAkfS3d455F6OvXPxOyeAXVgmaWUW3zwMYlE8LwYHdGlGZsEhGXv6t9sbXAAqL2I_yiBQ"}),$i=async()=>(await ht.execute({sql:`
    SELECT q.id, q.question, q.createdAt, COUNT(a.id) as answer_count
    FROM questions q
    LEFT JOIN answers a ON q.id = a.questionId
    GROUP BY q.id
    ORDER BY q.id DESC
  `,args:[]})).rows,Ai=async t=>(await ht.execute({sql:`
    SELECT a.id, a.answer
    FROM answers a
    WHERE a.questionId = ?
  `,args:[t]})).rows,Ei=async(t,e)=>{const n="INSERT INTO questions (question, createdAt) VALUES (?, ?)",s=[t,e];await ht.execute({sql:n,args:s})},Pi=async(t,e,n)=>{const s="INSERT INTO answers (answer, questionId, createdAt) VALUES (?, ?, ?)",r=[t,e,n];await ht.execute({sql:s,args:r})},Di=L({__name:"Sheet",props:{open:{type:Boolean},defaultOpen:{type:Boolean},modal:{type:Boolean}},emits:["update:open"],setup(t,{expose:e,emit:n}){e();const s=t,r=n,o=ut(s,r),i={props:s,emits:r,forwarded:o,get DialogRoot(){return Cn}};return Object.defineProperty(i,"__isScriptSetup",{enumerable:!1,value:!0}),i}});function ki(t,e,n,s,r,o){return I(),J(s.DialogRoot,Tt($t(s.forwarded)),{default:x(()=>[Q(t.$slots,"default")]),_:3},16)}const Oi=Z(Di,[["render",ki]]),Ui=L({__name:"SheetTrigger",props:{asChild:{type:Boolean},as:{}},setup(t,{expose:e}){e();const s={props:t,get DialogTrigger(){return In}};return Object.defineProperty(s,"__isScriptSetup",{enumerable:!1,value:!0}),s}});function Mi(t,e,n,s,r,o){return I(),J(s.DialogTrigger,Tt($t(s.props)),{default:x(()=>[Q(t.$slots,"default")]),_:3},16)}const Ni=Z(Ui,[["render",Mi]]),Bi=L({inheritAttrs:!1,__name:"SheetContent",props:{class:{},side:{},forceMount:{type:Boolean},trapFocus:{type:Boolean},disableOutsidePointerEvents:{type:Boolean},asChild:{type:Boolean},as:{}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","openAutoFocus","closeAutoFocus"],setup(t,{expose:e,emit:n}){e();const s=t,r=n,o=Y(()=>{const{class:l,side:c,...u}=s;return u}),i=ut(o,r),a={props:s,emits:r,delegatedProps:o,forwarded:i,get DialogClose(){return Tn},get DialogContent(){return $n},get DialogOverlay(){return An},get DialogPortal(){return En},get X(){return er},get sheetVariants(){return ea},get cn(){return oe}};return Object.defineProperty(a,"__isScriptSetup",{enumerable:!1,value:!0}),a}});function Li(t,e,n,s,r,o){return I(),J(s.DialogPortal,null,{default:x(()=>[O(s.DialogOverlay,{class:"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0"}),O(s.DialogContent,_e({class:s.cn(s.sheetVariants({side:n.side}),s.props.class)},{...s.forwarded,...t.$attrs}),{default:x(()=>[Q(t.$slots,"default"),O(s.DialogClose,{class:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-white transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-neutral-950 focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-neutral-100 dark:ring-offset-neutral-950 dark:focus:ring-neutral-300 dark:data-[state=open]:bg-neutral-800"},{default:x(()=>[O(s.X,{class:"w-4 h-4 text-neutral-500 dark:text-neutral-400"})]),_:1})]),_:3},16,["class"])]),_:3})}const ji=Z(Bi,[["render",Li]]),Fi=L({__name:"SheetHeader",props:{class:{}},setup(t,{expose:e}){e();const s={props:t,get cn(){return oe}};return Object.defineProperty(s,"__isScriptSetup",{enumerable:!1,value:!0}),s}});function Hi(t,e,n,s,r,o){return I(),X("div",{class:lt(s.cn("flex flex-col gap-y-2 text-center sm:text-left",s.props.class))},[Q(t.$slots,"default")],2)}const Vi=Z(Fi,[["render",Hi]]),zi=L({__name:"SheetTitle",props:{asChild:{type:Boolean},as:{},class:{}},setup(t,{expose:e}){e();const n=t,s=Y(()=>{const{class:o,...i}=n;return i}),r={props:n,delegatedProps:s,get DialogTitle(){return Pn},get cn(){return oe}};return Object.defineProperty(r,"__isScriptSetup",{enumerable:!1,value:!0}),r}});function Zi(t,e,n,s,r,o){return I(),J(s.DialogTitle,_e({class:s.cn("text-lg font-semibold text-neutral-950 dark:text-neutral-50",s.props.class)},s.delegatedProps),{default:x(()=>[Q(t.$slots,"default")]),_:3},16,["class"])}const Wi=Z(zi,[["render",Zi]]),Yi=L({__name:"SheetDescription",props:{asChild:{type:Boolean},as:{},class:{}},setup(t,{expose:e}){e();const n=t,s=Y(()=>{const{class:o,...i}=n;return i}),r={props:n,delegatedProps:s,get DialogDescription(){return Dn},get cn(){return oe}};return Object.defineProperty(r,"__isScriptSetup",{enumerable:!1,value:!0}),r}});function Qi(t,e,n,s,r,o){return I(),J(s.DialogDescription,_e({class:s.cn("text-sm text-neutral-500 dark:text-neutral-400",s.props.class)},s.delegatedProps),{default:x(()=>[Q(t.$slots,"default")]),_:3},16,["class"])}const Gi=Z(Yi,[["render",Qi]]),Ji=L({__name:"SheetFooter",props:{class:{}},setup(t,{expose:e}){e();const s={props:t,get cn(){return oe}};return Object.defineProperty(s,"__isScriptSetup",{enumerable:!1,value:!0}),s}});function Ki(t,e,n,s,r,o){return I(),X("div",{class:lt(s.cn("flex flex-col-reverse sm:flex-row sm:justify-end sm:gap-x-2",s.props.class))},[Q(t.$slots,"default")],2)}const Xi=Z(Ji,[["render",Ki]]),ea=tr("fixed z-50 gap-4 bg-white p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500 dark:bg-neutral-950",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}});var Cs=/^([0-9]{4})-([0-1][0-9])(?:-([0-3][0-9]))?(?:[T ]?([0-2][0-9])(?::([0-5][0-9]))?(?::([0-5][0-9]))?)?(?:\.[0-9]+)?(Z|(?:\+|\-)[0-9]{2}:?[0-9]{2})?$/;function ta(t){const e=t.match(Cs);if(e){const n=Number(e[2]);if(n<1||n>12)return!1;if(typeof e[3]!==void 0){const s=Number(e[3]);if(s<1||s>31)return!1}if(typeof e[4]!==void 0){const s=Number(e[4]);if(s<0||s>23)return!1}return!0}return!1}function na(t){const e=t.match(Cs);return e&&typeof e[4]>"u"?t+="T00:00:00":t}function We(t){if(t||(t=new Date),t instanceof Date){const e=new Date(t);return e.setMilliseconds(0),e}if(t=t.trim(),ta(t))return new Date(na(t));throw new Error(`Non ISO 8601 compliant date (${t}).`)}var Ft="1999-03-04T02:05:01.000Z",yt=new Map,Is=[["YYYY",{year:"numeric"}],["YY",{year:"2-digit"}],["MMMM",{month:"long"}],["MMM",{month:"short"}],["MM",{month:"2-digit"}],["M",{month:"numeric"}],["DD",{day:"2-digit"}],["D",{day:"numeric"}],["dddd",{weekday:"long"}],["ddd",{weekday:"short"}],["d",{weekday:"narrow"}],["mm",{minute:"2-digit"}],["m",{minute:"numeric"}],["ss",{second:"2-digit"}],["s",{second:"numeric"}],["ZZ",{timeZoneName:"long"}],["Z",{timeZoneName:"short"}]],Ts=[["HH",{hour:"2-digit"}],["H",{hour:"numeric"}]],$s=[["hh",{hour:"2-digit"}],["h",{hour:"numeric"}],["a",{dayPeriod:"narrow"}],["A",{dayPeriod:"narrow"}]];function sa(t){if(/^[+-]\d{2}:\d{2}/.test(t))return 6;if(/^[+-]\d{4}/.test(t))return 5;throw new Error("Invalid offset format")}var ra=["MMMM","MMM","dddd","ddd"],D=new Map([...Is,...Ts,...$s].map(t=>[t[0],t])),cn=new Map,oa=["full","long","medium","short"];function le(t){return t.type==="literal"&&(t.value=t.value.normalize("NFKC")),t}function ia(t,e,n,s=!1,r=null){const o=aa(t,e,n,s),i=We(t);function a({partName:l,partValue:c,token:u}){if(l==="literal")return c;const f=o[l];if(l==="hour"&&u==="H")return f.replace(/^0/,"")||"0";if(["mm","ss","MM"].includes(u)&&f.length===1)return`0${f}`;if(l==="dayPeriod"){const y=da(i.getUTCHours()<12?"am":"pm",n);return u==="A"?y.toUpperCase():y.toLowerCase()}return l==="timeZoneName"?r??As(-1*i.getTimezoneOffset(),u):f}return e.map(l=>({...l,value:a(l)}))}function aa(t,e,n,s=!1){const r=We(t),o=e.filter(u=>u.hour12),i=e.filter(u=>!u.hour12),a=[],l=[];function c(u,f=!1){const y=`${n}-u-hc-${f?"h12":"h23"}`;if(a.push(...new Intl.DateTimeFormat(y,u.reduce((m,h)=>h.partName==="literal"?m:(s&&ra.includes(h.token)&&l.push(h),Object.assign(m,h.option)),{timeZone:"UTC"})).formatToParts(r).map(le)),s&&l.length)for(const m of l){let h=[];switch(m.token){case"MMMM":h=new Intl.DateTimeFormat(y,{dateStyle:"long",timeZone:"UTC"}).formatToParts(r).map(le);break;case"MMM":h=new Intl.DateTimeFormat(y,{dateStyle:"medium",timeZone:"UTC"}).formatToParts(r).map(le);break}const d=h.find(b=>b.type===m.partName),p=a.findIndex(b=>b.type===m.partName);d&&p>-1&&(a[p]=d)}}return o.length&&c(o,!0),i.length&&c(i),a.reduce((u,f)=>(u[f.type]=f.value,u),{})}function As(t,e="Z"){const n=String(Math.floor(Math.abs(t/60))).padStart(2,"0"),s=String(Math.abs(t%60)).padStart(2,"0"),r=t<0?"-":"+";return e==="ZZ"?`${r}${n}${s}`:`${r}${n}:${s}`}function la(t,e){ua(t,e);const[n,s,r,o]=t.match(/([+-])([0-3][0-9]):?([0-6][0-9])/),i=Number(r)*60+Number(o);return s==="+"?i:-i}function ua(t,e="Z"){if(!(s=>{switch(s){case"Z":return/^([+-])[0-3][0-9]:[0-6][0-9]$/.test(t);case"ZZ":return/^([+-])[0-3][0-9][0-6][0-9]$/.test(t)}})(e))throw new Error(`Invalid offset: ${t}`);return t}function ca(t){return typeof t=="string"?t.includes("ZZ")?"ZZ":"Z":"time"in t&&t.time==="full"?"Z":"ZZ"}function da(t,e){const n=cn.get(e);if(n&&n[t])return n[t];const s=new Date(Ft);s.setUTCHours(t==="am"?5:20);const o=new Intl.DateTimeFormat(e,{timeStyle:"full",timeZone:"UTC",hour12:!0}).formatToParts(s).map(le).find(i=>i.type==="dayPeriod");if(o){const i=n||{};return cn.set(e,Object.assign(i,{[t]:o.value})),o.value}return t}function fa(t,e="+00:00"){const n=We(t),s=(()=>{switch(sa(e)){case 5:return"ZZ";case 6:return"Z"}})(),r=la(e,s);return new Date(n.getTime()+r*1e3*60)}function Es(){return Intl.DateTimeFormat().resolvedOptions().timeZone}function dn(t,e){const n=new Intl.DateTimeFormat("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:e,hourCycle:"h23"}).formatToParts(t).map(le),s={};return n.forEach(r=>{s[r.type]=r.value}),new Date(`${s.year}-${s.month}-${s.day}T${s.hour}:${s.minute}:${s.second}Z`)}function fn(t,e="UTC",n="device",s="Z"){var r;n=n==="device"?(r=Es())!=null?r:"utc":n;const o=We(t),i=dn(o,e),a=dn(o,n),l=Math.round((a.getTime()-i.getTime())/1e3/60);return As(l,s)}function ha(t,e){if(oa.includes(t)||typeof t=="object")return pa(t,e);let n=t,s=0;const r=u=>{if(u[2]||(u[2]=new RegExp(`(.)?(${u[0]})`,"g")),u[2].test(n)){let f=0;return n=n.replace(u[2],(y,m,h)=>m==="\\"?h:`${typeof m=="string"?m:""}{!${f++?s:s++}!}`),!!f}return!1};function o(u){const f=u.map(m=>m.partName),y=new Set(f);if(f.length>y.size)throw new Error("Cannot reuse format tokens.");return u}function i(u,[f,y,m]){const h=Object.keys(y)[0],d=y[h];return{option:y,partName:h,partValue:d,token:f,pattern:m,hour12:u}}const a=Is.filter(r).concat(Ts.filter(r)).map(i.bind(null,!1)),l=o(a.concat($s.filter(r).map(i.bind(null,!0)))),c=/^\{!(\d+)!\}$/;return n.split(/(\{!\d+!\})/).map(u=>{const f=u.match(c);return f?l[Number(f[1])]:{option:{literal:u},partName:"literal",partValue:u,token:u,pattern:new RegExp(""),hour12:!1}}).filter(u=>!(u.partName==="literal"&&u.partValue===""))}function pa(t,e){const n={timeZone:"UTC"};typeof t=="string"?n.dateStyle=t:("date"in t&&(n.dateStyle=t.date),"time"in t&&(n.timeStyle=t.time));const s=new Intl.DateTimeFormat(e,n),r=s.formatToParts(new Date(Ft)).map(le),i=s.formatToParts(new Date("1999-04-05T23:05:01.000Z")).map(le).find(l=>l.type==="hour"),a=i&&i.value==="23"?24:12;return r.map(l=>{const c=l.type,u=ma(l.type,l.value,e,l.type==="hour"?a:void 0,n);if(u===void 0)return;const f=u[1][c];if(f)return u[2]||(u[2]=new RegExp(`${u[0]}`,"g")),{option:{[c]:f},partName:c,partValue:f,token:u[0],pattern:u[2],hour12:a===12}}).filter(l=>!!l)}function ma(t,e,n,s,r){const o=e.length,i=!isNaN(Number(e));let a;switch(t){case"year":return o===2?D.get("YY"):D.get("YYYY");case"month":if(i)return o===1?D.get("M"):D.get("MM");switch(a=hn(n,t,e),a){case"long":return D.get("MMMM");default:return D.get("MMM")}case"day":return o===1?D.get("D"):D.get("DD");case"weekday":switch(a=hn(n,t,e),a){case"narrow":return D.get("d");case"short":return D.get("ddd");default:return D.get("dddd")}case"hour":return s===12?o===1?D.get("h"):D.get("hh"):o===1?D.get("H"):D.get("HH");case"minute":return o===1?D.get("m"):D.get("mm");case"second":return o===1?D.get("s"):D.get("ss");case"dayPeriod":return/^[A-Z]+$/u.test(e)?D.get("A"):D.get("a");case"literal":return[e,{literal:e},new RegExp("")];case"timeZoneName":return r.timeStyle==="full"?D.get("Z"):D.get("ZZ");default:return}}function hn(t,e,n){if(!yt.has(t)){const r=new Date(Ft),o=[3,8,9,7,6,4,3],i=["weekday","month","dayPeriod"],a=["long","short","narrow"],l={};for(let c=0;c<12;c++){r.setMonth(0+c),c in o&&r.setDate(o[c]),r.setUTCHours(8+c);for(const u of a){const f=new Intl.DateTimeFormat(t,i.reduce((y,m)=>Object.assign(y,{[m]:u}),{hour12:!0,timeZone:"UTC"})).formatToParts(r).map(le);if(u==="long"||u==="short"){const m=new Intl.DateTimeFormat(t,{dateStyle:u==="short"?"medium":"long",timeZone:"UTC"}).formatToParts(r).map(le).find(d=>d.type==="month"),h=f.findIndex(d=>d.type==="month");h>-1&&m&&(f[h]=m)}f.forEach(y=>{if(y.type==="literal")return;const m=y.type;l[m]=Object.assign(l[m]||{},{[y.value]:u})})}}yt.set(t,l)}const s=yt.get(t);return s?s[e][n]:void 0}function ya(t,e="+00:00"){const n=e.slice(0,1)==="+";return fa(t,e.replace(n?"+":"-",n?"-":"+"))}function wa(){return Intl.DateTimeFormat().resolvedOptions().locale}function pn(t,e="long",n="device",s=!1,r){let o,i;return typeof t=="object"&&!(t instanceof Date)&&({date:t,format:e,locale:n,genitive:s,partFilter:r,tz:o}=t),e==="ISO8601"?We(t).toISOString():(o&&(i=fn(t,"utc",o,ca(e))),o??(o=Es()),o?.toLowerCase()!=="utc"&&(t=ya(t,fn(t,o,"utc"))),(!n||n==="device")&&(n=wa()),ia(t,ha(e,n).filter(r??(()=>!0)),n,s,i).map(a=>a.value).join(""))}const ba=L({__name:"CardQuestion",props:{data:{}},setup(t,{expose:e}){e();const n=t,{toast:s}=kn(),{id:r,question:o,createdAt:i}=n.data,a=E([]);bn(async()=>{a.value=await Ai(r)});function l(d){const p=pn(d,"MMMM D, YYYY. hh:mm a","es");return p.charAt(0).toUpperCase()+p.slice(1)}function c(d){const p=pn(d,"D/M/YY. hh:mm a","es");return p.charAt(0).toUpperCase()+p.slice(1)}let u=E(!1),f=E("");function y(){u.value=!u.value,console.log(u.value)}async function m(){if(!f.value){s({title:"Campos vacíos.",description:"Debes escribir una respuesta.",variant:"destructive"});return}await Pi(f.value,n.data.id,new Date().toISOString()),s({description:"Respuesta enviada correctamente."}),a.value.push({answer:f.value,createdAt:new Date().toISOString()}),f.value="",u.value=!1}const h={props:n,toast:s,id:r,question:o,createdAt:i,answers:a,formatDate:l,formatDateSmall:c,get show(){return u},set show(d){u=d},get answerText(){return f},set answerText(d){f=d},toggleShow:y,addAnswer:m,get Sheet(){return Oi},get SheetContent(){return ji},get SheetDescription(){return Gi},get SheetFooter(){return Xi},get SheetHeader(){return Vi},get SheetTitle(){return Wi},get SheetTrigger(){return Ni}};return Object.defineProperty(h,"__isScriptSetup",{enumerable:!1,value:!0}),h}}),ga={class:"text-slate-500"},va={class:"text-2xl text-slate-600 text-left"},_a={class:"my-4 h-full space-y-2 overflow-auto"},Sa={class:"font-semibold text-slate-500 text-sm"},xa={class:"text-sm font-normal text-slate-400"},Ra={class:"text-slate-500"},qa={key:1},Ca={key:0,class:"my-4"};function Ia(t,e,n,s,r,o){return I(),J(s.Sheet,null,{default:x(()=>[O(s.SheetTrigger,{"as-child":""},{default:x(()=>[Q(t.$slots,"default")]),_:3}),O(s.SheetContent,{class:"flex flex-col justify-between"},{default:x(()=>[O(s.SheetHeader,null,{default:x(()=>[O(s.SheetDescription,null,{default:x(()=>[R("p",ga,Ce(s.formatDate(s.createdAt)),1)]),_:1}),O(s.SheetTitle,null,{default:x(()=>[R("h2",va,Ce(s.question),1)]),_:1})]),_:1}),R("section",_a,[s.answers.length>0?(I(!0),X(gn,{key:0},vn(s.answers,(i,a)=>(I(),X("div",{key:a,class:"border border-slate-300 p-4 rounded-2xl"},[R("p",Sa,[e[1]||(e[1]=_n("Anonimo#2834 - ")),R("time",xa,Ce(s.formatDateSmall(i.createdAt)),1)]),R("p",Ra,Ce(i.answer),1)]))),128)):(I(),X("div",qa,e[2]||(e[2]=[R("p",{class:"bg-slate-100 text-slate-500 p-2 text-center rounded-xl"},"No hay respuestas",-1)])))]),O(s.SheetFooter,null,{default:x(()=>[s.show?(I(),X("section",Ca,[Sn(R("textarea",{"onUpdate:modelValue":e[0]||(e[0]=i=>s.answerText=i),class:"w-full h-32 p-4 mt-4 text-sm text-gray-600 placeholder-gray-400 bg-gray-100 border border-gray-300 rounded-lg",placeholder:"Escribe tu respuesta"},null,512),[[xn,s.answerText]]),R("button",{onClick:s.addAnswer,class:"w-full bg-indigo-600 text-white p-4 rounded-2xl"}," Enviar respuesta ")])):Kt("",!0),s.show?Kt("",!0):(I(),X("button",{key:1,onClick:s.toggleShow,class:"w-full bg-indigo-600 text-white p-4 rounded-2xl"}," Agregar respuesta "))]),_:1})]),_:1})]),_:3})}const Ta=Z(ba,[["render",Ia]]);(function(){try{if(typeof document<"u"){var t=document.createElement("style");t.appendChild(document.createTextNode('[vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32,.72,0,1)}[vaul-drawer][vaul-drawer-direction=bottom]{transform:translate3d(0,100%,0)}[vaul-drawer][vaul-drawer-direction=top]{transform:translate3d(0,-100%,0)}[vaul-drawer][vaul-drawer-direction=left]{transform:translate3d(-100%,0,0)}[vaul-drawer][vaul-drawer-direction=right]{transform:translate3d(100%,0,0)}.vaul-dragging .vaul-scrollable [vault-drawer-direction=top],.vaul-dragging .vaul-scrollable [vault-drawer-direction=bottom]{overflow-y:hidden!important}.vaul-dragging .vaul-scrollable [vault-drawer-direction=left],.vaul-dragging .vaul-scrollable [vault-drawer-direction=right]{overflow-x:hidden!important}[vaul-drawer][vaul-drawer-visible=true][vaul-drawer-direction=top],[vaul-drawer][vaul-drawer-visible=true][vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height, 0),0)}[vaul-drawer][vaul-drawer-visible=true][vaul-drawer-direction=left],[vaul-drawer][vaul-drawer-visible=true][vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height, 0),0,0)}[vaul-overlay]{opacity:0;transition:opacity .5s cubic-bezier(.32,.72,0,1)}[vaul-overlay][vaul-drawer-visible=true]{opacity:1}[vaul-drawer]:after{content:"";position:absolute;background:inherit;background-color:inherit}[vaul-drawer][vaul-drawer-direction=top]:after{top:initial;bottom:100%;left:0;right:0;height:200%}[vaul-drawer][vaul-drawer-direction=bottom]:after{top:100%;bottom:initial;left:0;right:0;height:200%}[vaul-drawer][vaul-drawer-direction=left]:after{left:initial;right:100%;top:0;bottom:0;width:200%}[vaul-drawer][vaul-drawer-direction=right]:after{left:100%;right:initial;top:0;bottom:0;width:200%}[vaul-overlay][vaul-snap-points=true]:not([vaul-snap-points-overlay=true]):not([data-state=closed]){opacity:0}[vaul-overlay][vaul-snap-points-overlay=true]:not([vaul-drawer-visible=false]){opacity:1}@keyframes fake-animation{}@media (hover: hover) and (pointer: fine){[vaul-drawer]{-webkit-user-select:none;user-select:none}}')),document.head.appendChild(t)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();const $a=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Aa=t=>typeof t<"u";function Ea(t){return JSON.parse(JSON.stringify(t))}function mn(t,e,n,s={}){var r,o,i;const{clone:a=!1,passive:l=!1,eventName:c,deep:u=!1,defaultValue:f,shouldEmit:y}=s,m=Ks(),h=n||m?.emit||((r=m?.$emit)==null?void 0:r.bind(m))||((i=(o=m?.proxy)==null?void 0:o.$emit)==null?void 0:i.bind(m?.proxy));let d=c;e||(e="modelValue"),d=d||`update:${e.toString()}`;const p=_=>a?typeof a=="function"?a(_):Ea(_):_,b=()=>Aa(t[e])?p(t[e]):f,v=_=>{y?y(_)&&h(d,_):h(d,_)};if(l){const _=b(),F=E(_);let q=!1;return ve(()=>t[e],k=>{q||(q=!0,F.value=p(k),Rn(()=>q=!1))}),ve(F,k=>{!q&&(k!==t[e]||u)&&v(k)},{deep:u}),F}else return Y({get(){return b()},set(_){v(_)}})}const[Ps,Pa]=nr("DrawerRoot"),Ds=new WeakMap;function P(t,e,n=!1){if(!t||!(t instanceof HTMLElement)||!e)return;const s={};Object.entries(e).forEach(([r,o])=>{if(r.startsWith("--")){t.style.setProperty(r,o);return}s[r]=t.style[r],t.style[r]=o}),!n&&Ds.set(t,s)}function Xe(t,e){if(!t||!(t instanceof HTMLElement))return;const n=Ds.get(t);n&&(e?t.style[e]=n[e]:Object.entries(n).forEach(([s,r])=>{t.style[s]=r}))}function et(t,e){const n=window.getComputedStyle(t),s=n.transform||n.webkitTransform||n.mozTransform;let r=s.match(/^matrix3d\((.+)\)$/);return r?Number.parseFloat(r[1].split(", ")[M(e)?13:12]):(r=s.match(/^matrix\((.+)\)$/),r?Number.parseFloat(r[1].split(", ")[M(e)?5:4]):null)}function Da(t){return 8*(Math.log(t+1)-2)}function M(t){switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}}const $={DURATION:.5,EASE:[.32,.72,0,1]},ks=.4;function ka({activeSnapPoint:t,snapPoints:e,drawerRef:n,overlayRef:s,fadeFromIndex:r,onSnapPointChange:o,direction:i}){const a=Y(()=>(e.value&&t.value===e.value[e.value.length-1])??null),l=Y(()=>e.value&&e.value.length>0&&(r?.value||r?.value===0)&&!Number.isNaN(r?.value)&&e.value[r?.value??-1]===t.value||!e.value),c=Y(()=>{var p;return((p=e.value)==null?void 0:p.findIndex(b=>b===t.value))??null}),u=Y(()=>{var p;return((p=e.value)==null?void 0:p.map(b=>{const v=typeof window<"u",_=typeof b=="string";let F=0;if(_&&(F=Number.parseInt(b,10)),M(i.value)){const k=_?F:v?b*window.innerHeight:0;return v?i.value==="bottom"?window.innerHeight-k:-window.innerHeight+k:k}const q=_?F:v?b*window.innerWidth:0;return v?i.value==="right"?window.innerWidth-q:-window.innerWidth+q:q}))??[]}),f=Y(()=>{var p;return c.value!==null?(p=u.value)==null?void 0:p[c.value]:null}),y=p=>{var b,v,_,F;const q=((b=u.value)==null?void 0:b.findIndex(k=>k===p))??null;Rn(()=>{var k;o(q,u.value),P((k=n.value)==null?void 0:k.$el,{transition:`transform ${$.DURATION}s cubic-bezier(${$.EASE.join(",")})`,transform:M(i.value)?`translate3d(0, ${p}px, 0)`:`translate3d(${p}px, 0, 0)`})}),u.value&&q!==u.value.length-1&&q!==r?.value?P((v=s.value)==null?void 0:v.$el,{transition:`opacity ${$.DURATION}s cubic-bezier(${$.EASE.join(",")})`,opacity:"0"}):P((_=s.value)==null?void 0:_.$el,{transition:`opacity ${$.DURATION}s cubic-bezier(${$.EASE.join(",")})`,opacity:"1"}),t.value=q!==null?((F=e.value)==null?void 0:F[q])??null:null};ve([t,u,e],()=>{var p;if(t.value){const b=((p=e.value)==null?void 0:p.findIndex(v=>v===t.value))??-1;u.value&&b!==-1&&typeof u.value[b]=="number"&&y(u.value[b])}},{immediate:!0});function m({draggedDistance:p,closeDrawer:b,velocity:v,dismissible:_}){var F,q,k;if(r===void 0)return;const fe=i.value==="bottom"||i.value==="right"?(f.value??0)-p:(f.value??0)+p,Ye=c.value===(r.value??0)-1,Se=c.value===0,ue=p>0;if(Ye&&P((F=s.value)==null?void 0:F.$el,{transition:`opacity ${$.DURATION}s cubic-bezier(${$.EASE.join(",")})`}),v>2&&!ue){_?b():y(u.value[0]);return}if(v>2&&ue&&u&&e.value){y(u.value[e.value.length-1]);return}const Me=(q=u.value)==null?void 0:q.reduce((ie,S)=>typeof ie!="number"||typeof S!="number"?ie:Math.abs(S-fe)<Math.abs(ie-fe)?S:ie),xe=M(i.value)?window.innerHeight:window.innerWidth;if(v>ks&&Math.abs(p)<xe*.4){const ie=ue?1:-1;if(ie>0&&a){y(u.value[(((k=e.value)==null?void 0:k.length)??0)-1]);return}if(Se&&ie<0&&_&&b(),c.value===null)return;y(u.value[c.value+ie]);return}y(Me)}function h({draggedDistance:p}){var b;if(f.value===null)return;const v=i.value==="bottom"||i.value==="right"?(f.value??0)-p:(f.value??0)+p;(i.value==="bottom"||i.value==="right")&&v<u.value[u.value.length-1]||(i.value==="top"||i.value==="left")&&v>u.value[u.value.length-1]||P((b=n.value)==null?void 0:b.$el,{transform:M(i.value)?`translate3d(0, ${v}px, 0)`:`translate3d(${v}px, 0, 0)`})}function d(p,b){if(!e||typeof c.value!="number"||!u.value||r===void 0)return null;const v=c.value===(r.value??0)-1;if(c.value>=(r.value??0)&&b)return 0;if(v&&!b)return 1;if(!l.value&&!v)return null;const _=v?c.value+1:c.value-1,F=v?u.value[_]-u.value[_-1]:u.value[_+1]-u.value[_],q=p/Math.abs(F);return v?1-q:q}return{isLastSnapPoint:a,shouldFade:l,getPercentageDragged:d,activeSnapPointIndex:c,onRelease:m,onDrag:h,snapPointsOffset:u}}let Be=null;function Oa(t){const{isOpen:e,modal:n,nested:s,hasBeenOpened:r}=t,o=E(typeof window<"u"?window.location.href:""),i=E(0);function a(){if(Be===null&&e.value){Be={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height};const{scrollX:c,innerHeight:u}=window;document.body.style.position="fixed",document.body.style.top=`-${i.value}px`,document.body.style.left=`-${c}px`,document.body.style.right="0px",document.body.style.height="auto",setTimeout(()=>{requestAnimationFrame(()=>{const f=u-window.innerHeight;f&&i.value>=u&&(document.body.style.top=`-${i.value+f}px`)})},300)}}function l(){if(Be!==null){const c=-Number.parseInt(document.body.style.top,10),u=-Number.parseInt(document.body.style.left,10);Object.assign(document.body.style,Be),requestAnimationFrame(()=>{if(o.value!==window.location.href){o.value=window.location.href;return}window.scrollTo(u,c)}),Be=null}}return bn(()=>{function c(){i.value=window.scrollY}c(),window.addEventListener("scroll",c),qn(()=>{window.removeEventListener("scroll",c)})}),ve([e,r,o],()=>{s.value||!r.value||(e.value?(!window.matchMedia("(display-mode: standalone)").matches&&a(),n.value||setTimeout(()=>{l()},500)):l())}),{restorePositionSetting:l}}const Ua=.25,Ma=100,yn=8,me=16,Na=26,wn="vaul-dragging";function Ba(t,e){return t&&t.value?t:e}function La(t){const{emitDrag:e,emitRelease:n,emitClose:s,emitOpenChange:r,open:o,dismissible:i,nested:a,fixed:l,modal:c,shouldScaleBackground:u,scrollLockTimeout:f,closeThreshold:y,activeSnapPoint:m,fadeFromIndex:h,direction:d}=t,p=E(o.value??!1),b=E(!1),v=E(!1),_=E(!1),F=E(!1),q=E(null),k=E(null),fe=E(null),Ye=E(null),Se=E(null),ue=E(!0),Me=E(null),xe=E(0),ie=E(!1);E(0);const S=E(null);E(0);const Ht=Y(()=>{var w;return((w=S.value)==null?void 0:w.$el.getBoundingClientRect().height)||0}),te=Ba(t.snapPoints,E(void 0)),{activeSnapPointIndex:Vt,onRelease:Os,snapPointsOffset:Us,onDrag:Ms,shouldFade:zt,getPercentageDragged:Ns}=ka({snapPoints:te,activeSnapPoint:m,drawerRef:S,fadeFromIndex:h,overlayRef:q,onSnapPointChange:Bs,direction:d});function Bs(w,C){te.value&&w===C.length-1&&(k.value=new Date)}const{restorePositionSetting:Ls}=Oa({isOpen:p,modal:c,nested:a,hasBeenOpened:b});function Re(){return(window.innerWidth-Na)/window.innerWidth}function Zt(w,C){var j;if(!w)return!1;let A=w;const H=(j=window.getSelection())==null?void 0:j.toString(),G=S.value?et(S.value.$el,d.value):null,ne=new Date;if(A.hasAttribute("data-vaul-no-drag")||A.closest("[data-vaul-no-drag]"))return!1;if(d.value==="right"||d.value==="left")return!0;if(k.value&&ne.getTime()-k.value.getTime()<500)return!1;if(G!==null&&(d.value==="bottom"?G>0:G<0))return!0;if(H&&H.length>0)return!1;if(Se.value&&ne.getTime()-Se.value.getTime()<f.value&&G===0||C)return Se.value=ne,!1;for(;A;){if(A.scrollHeight>A.clientHeight){if(A.scrollTop!==0)return Se.value=new Date,!1;if(A.getAttribute("role")==="dialog")return!0}A=A.parentNode}return!0}function js(w){!i.value&&!te.value||S.value&&!S.value.$el.contains(w.target)||(_.value=!0,fe.value=new Date,w.target.setPointerCapture(w.pointerId),xe.value=M(d.value)?w.clientY:w.clientX)}function Fs(w){var C,j,A,H,G,ne;if(S.value&&_.value){const qe=d.value==="bottom"||d.value==="right"?1:-1,Qe=(xe.value-(M(d.value)?w.clientY:w.clientX))*qe,Ge=Qe>0,Yt=te.value&&!i.value&&!Ge;if(Yt&&Vt.value===0)return;const mt=Math.abs(Qe),Qt=document.querySelector("[vaul-drawer-wrapper]");let he=mt/Ht.value;const Gt=Ns(mt,Ge);if(Gt!==null&&(he=Gt),Yt&&he>=1||!ue.value&&!Zt(w.target,Ge))return;if((C=S?.value)==null||C.$el.classList.add(wn),ue.value=!0,P((j=S.value)==null?void 0:j.$el,{transition:"none"}),P((A=q.value)==null?void 0:A.$el,{transition:"none"}),te.value&&Ms({draggedDistance:Qe}),Ge&&!te.value){const pe=Da(Qe),Je=Math.min(pe*-1,0)*qe;P((H=S.value)==null?void 0:H.$el,{transform:M(d.value)?`translate3d(0, ${Je}px, 0)`:`translate3d(${Je}px, 0, 0)`});return}const Ws=1-he;if((zt.value||h.value&&Vt.value===h.value-1)&&(e(he),P((G=q.value)==null?void 0:G.$el,{opacity:`${Ws}`,transition:"none"},!0)),Qt&&q.value&&u.value){const pe=Math.min(Re()+he*(1-Re()),1),Je=8-he*8,Jt=Math.max(0,14-he*14);P(Qt,{borderRadius:`${Je}px`,transform:M(d.value)?`scale(${pe}) translate3d(0, ${Jt}px, 0)`:`scale(${pe}) translate3d(${Jt}px, 0, 0)`,transition:"none"},!0)}if(!te.value){const pe=mt*qe;P((ne=S.value)==null?void 0:ne.$el,{transform:M(d.value)?`translate3d(0, ${pe}px, 0)`:`translate3d(${pe}px, 0, 0)`})}}}function Wt(){var w;if(!S.value)return;const C=document.querySelector("[vaul-drawer-wrapper]"),j=et(S.value.$el,d.value);P(S.value.$el,{transform:"translate3d(0, 0, 0)",transition:`transform ${$.DURATION}s cubic-bezier(${$.EASE.join(",")})`}),P((w=q.value)==null?void 0:w.$el,{transition:`opacity ${$.DURATION}s cubic-bezier(${$.EASE.join(",")})`,opacity:"1"}),u.value&&j&&j>0&&p.value&&P(C,{borderRadius:`${yn}px`,overflow:"hidden",...M(d.value)?{transform:`scale(${Re()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Re()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${$.DURATION}s`,transitionTimingFunction:`cubic-bezier(${$.EASE.join(",")})`},!0)}function Ne(){var w;S.value&&(P(S.value.$el,{transform:M(d.value)?`translate3d(0, ${d.value==="bottom"?"100%":"-100%"}, 0)`:`translate3d(${d.value==="right"?"100%":"-100%"}, 0, 0)`,transition:`transform ${$.DURATION}s cubic-bezier(${$.EASE.join(",")})`}),P((w=q.value)==null?void 0:w.$el,{opacity:"0",transition:`opacity ${$.DURATION}s cubic-bezier(${$.EASE.join(",")})`}),pt(!1),window.setTimeout(()=>{v.value=!1,p.value=!1},300),window.setTimeout(()=>{te.value&&(m.value=te.value[0])},$.DURATION*1e3))}Js(()=>{if(!p.value&&u.value&&$a){const w=setTimeout(()=>{Xe(document.body)},200);return()=>clearTimeout(w)}}),qn(()=>{pt(!1),Ls()});function Hs(w){if(!_.value||!S.value)return;S.value.$el.classList.remove(wn),ue.value=!1,_.value=!1,Ye.value=new Date;const C=et(S.value.$el,d.value);if(!Zt(w.target,!1)||!C||Number.isNaN(C)||fe.value===null)return;const j=Ye.value.getTime()-fe.value.getTime(),A=xe.value-(M(d.value)?w.clientY:w.clientX),H=Math.abs(A)/j;if(H>.05&&(F.value=!0,window.setTimeout(()=>{F.value=!1},200)),te.value){const ne=d.value==="bottom"||d.value==="right"?1:-1;Os({draggedDistance:A*ne,closeDrawer:Ne,velocity:H,dismissible:i.value}),n(!0);return}if(d.value==="bottom"||d.value==="right"?A>0:A<0){Wt(),n(!0);return}if(H>ks){Ne(),n(!1);return}const G=Math.min(S.value.$el.getBoundingClientRect().height??0,window.innerHeight);if(C>=G*y.value){Ne(),n(!1);return}n(!0),Wt()}ve(p,w=>{w&&(k.value=new Date,pt(!0)),r(w)},{immediate:!0}),ve(o,w=>{w?(p.value=w,b.value=!0):Ne()},{immediate:!0});function pt(w){const C=document.querySelector("[vaul-drawer-wrapper]");!C||!u.value||(w?(P(document.body,{background:document.body.style.backgroundColor||document.body.style.background}),P(document.body,{background:"black"},!0),P(C,{borderRadius:`${yn}px`,overflow:"hidden",...M(d.value)?{transform:`scale(${Re()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Re()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${$.DURATION}s`,transitionTimingFunction:`cubic-bezier(${$.EASE.join(",")})`})):(Xe(C,"overflow"),Xe(C,"transform"),Xe(C,"borderRadius"),P(C,{transitionProperty:"transform, border-radius",transitionDuration:`${$.DURATION}s`,transitionTimingFunction:`cubic-bezier(${$.EASE.join(",")})`})))}function Vs(w){var C,j;const A=w?(window.innerWidth-me)/window.innerWidth:1,H=w?-me:0;Me.value&&window.clearTimeout(Me.value),P((C=S.value)==null?void 0:C.$el,{transition:`transform ${$.DURATION}s cubic-bezier(${$.EASE.join(",")})`,transform:`scale(${A}) translate3d(0, ${H}px, 0)`}),!w&&(j=S.value)!=null&&j.$el&&(Me.value=window.setTimeout(()=>{var G,ne;const qe=et((G=S.value)==null?void 0:G.$el,d.value);P((ne=S.value)==null?void 0:ne.$el,{transition:"none",transform:M(d.value)?`translate3d(0, ${qe}px, 0)`:`translate3d(${qe}px, 0, 0)`})},500))}function zs(w){var C;if(w<0)return;const j=M(d.value)?window.innerHeight:window.innerWidth,A=(j-me)/j,H=A+w*(1-A),G=-me+w*me;P((C=S.value)==null?void 0:C.$el,{transform:M(d.value)?`scale(${H}) translate3d(0, ${G}px, 0)`:`scale(${H}) translate3d(${G}px, 0, 0)`,transition:"none"})}function Zs(w){var C;const j=M(d.value)?window.innerHeight:window.innerWidth,A=w?(j-me)/j:1,H=w?-me:0;w&&P((C=S.value)==null?void 0:C.$el,{transition:`transform ${$.DURATION}s cubic-bezier(${$.EASE.join(",")})`,transform:M(d.value)?`scale(${A}) translate3d(0, ${H}px, 0)`:`scale(${A}) translate3d(${H}px, 0, 0)`})}return{open:o,isOpen:p,modal:c,keyboardIsOpen:ie,hasBeenOpened:b,isVisible:v,drawerRef:S,drawerHeightRef:Ht,overlayRef:q,isDragging:_,dragStartTime:fe,isAllowedToDrag:ue,snapPoints:te,activeSnapPoint:m,pointerStart:xe,dismissible:i,snapPointsOffset:Us,direction:d,shouldFade:zt,fadeFromIndex:h,shouldScaleBackground:u,onPress:js,onDrag:Fs,onRelease:Hs,closeDrawer:Ne,onNestedDrag:zs,onNestedRelease:Zs,onNestedOpenChange:Vs,emitClose:s,emitDrag:e,emitRelease:n,emitOpenChange:r,nested:a}}const ja=L({__name:"DrawerRoot",props:{activeSnapPoint:{default:void 0},closeThreshold:{default:Ua},shouldScaleBackground:{type:Boolean,default:void 0},scrollLockTimeout:{default:Ma},fixed:{type:Boolean,default:void 0},dismissible:{type:Boolean,default:!0},modal:{type:Boolean,default:!0},open:{type:Boolean,default:void 0},defaultOpen:{type:Boolean,default:void 0},nested:{type:Boolean,default:!1},direction:{default:"bottom"},snapPoints:{default:void 0},fadeFromIndex:{default:void 0}},emits:["drag","release","close","update:open","update:activeSnapPoint"],setup(t,{expose:e,emit:n}){const s=t,r=n;Ys();const o=Y(()=>s.fadeFromIndex??(s.snapPoints&&s.snapPoints.length-1)),i=mn(s,"open",r,{defaultValue:s.defaultOpen,passive:s.open===void 0}),a=mn(s,"activeSnapPoint",r,{passive:s.activeSnapPoint===void 0}),l={emitDrag:h=>r("drag",h),emitRelease:h=>r("release",h),emitClose:()=>r("close"),emitOpenChange:h=>{r("update:open",h)}},{closeDrawer:c,hasBeenOpened:u,modal:f,isOpen:y}=Pa(La({...l,...Qs(s),activeSnapPoint:a,fadeFromIndex:o,open:i}));function m(h){if(i.value!==void 0){l.emitOpenChange(h);return}h?(u.value=!0,y.value=h):c()}return e({open:y}),(h,d)=>(I(),J(W(Cn),{open:W(y),modal:W(f),"onUpdate:open":m},{default:x(()=>[Q(h.$slots,"default",{open:W(y)})]),_:3},8,["open","modal"]))}}),Fa=L({__name:"DrawerOverlay",setup(t){const{overlayRef:e,snapPoints:n,isVisible:s,isOpen:r,shouldFade:o}=Ps(),i=Y(()=>{var a;return n&&(((a=n.value)==null?void 0:a.length)??0)>0});return(a,l)=>(I(),J(W(An),{ref_key:"overlayRef",ref:e,"vaul-drawer-visible":W(s)?"true":"false","vaul-overlay":"","vaul-snap-points":W(r)&&i.value?"true":"false","vaul-snap-points-overlay":W(r)&&W(o)?"true":"false"},null,8,["vaul-drawer-visible","vaul-snap-points","vaul-snap-points-overlay"]))}}),Ha=L({__name:"DrawerContent",setup(t){const{open:e,isOpen:n,isVisible:s,snapPointsOffset:r,drawerRef:o,onPress:i,onDrag:a,onRelease:l,modal:c,emitOpenChange:u,dismissible:f,keyboardIsOpen:y,closeDrawer:m,direction:h}=Ps(),d=Y(()=>r.value&&r.value.length>0?`${r.value[0]}px`:"0");function p(b){if(!c.value||b.defaultPrevented){b.preventDefault();return}y.value&&(y.value=!1),b.preventDefault(),f.value&&u(!1),!(!f.value||e.value!==void 0)&&m()}return ve(n,b=>{b&&setTimeout(()=>{s.value=!0},1)},{immediate:!0}),(b,v)=>(I(),J(W($n),{ref_key:"drawerRef",ref:o,"vaul-drawer":"","vaul-drawer-direction":W(h),"vaul-drawer-visible":W(s)?"true":"false",style:Gs({"--snap-point-height":d.value}),onPointerdown:W(i),onPointermove:W(a),onPointerup:W(l),onPointerDownOutside:p,onEscapeKeyDown:v[0]||(v[0]=_=>{W(f)||_.preventDefault()})},{default:x(()=>[Q(b.$slots,"default")]),_:3},8,["vaul-drawer-direction","vaul-drawer-visible","style","onPointerdown","onPointermove","onPointerup"]))}}),Va=L({__name:"Drawer",props:{activeSnapPoint:{},closeThreshold:{},shouldScaleBackground:{type:Boolean,default:!0},scrollLockTimeout:{},fixed:{type:Boolean},dismissible:{type:Boolean},modal:{type:Boolean},open:{type:Boolean},defaultOpen:{type:Boolean},nested:{type:Boolean},direction:{},snapPoints:{},fadeFromIndex:{}},emits:["drag","release","close","update:open","update:activeSnapPoint"],setup(t,{expose:e,emit:n}){e();const s=t,r=n,o=ut(s,r),i={props:s,emits:r,forwarded:o,get DrawerRoot(){return ja}};return Object.defineProperty(i,"__isScriptSetup",{enumerable:!1,value:!0}),i}});function za(t,e,n,s,r,o){return I(),J(s.DrawerRoot,Tt($t(s.forwarded)),{default:x(()=>[Q(t.$slots,"default")]),_:3},16)}const Za=Z(Va,[["render",za]]),Wa=L({__name:"DrawerOverlay",props:{forceMount:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(t,{expose:e}){e();const n=t,s=Y(()=>{const{class:o,...i}=n;return i}),r={props:n,delegatedProps:s,get DrawerOverlay(){return Fa},get cn(){return oe}};return Object.defineProperty(r,"__isScriptSetup",{enumerable:!1,value:!0}),r}});function Ya(t,e,n,s,r,o){return I(),J(s.DrawerOverlay,_e(s.delegatedProps,{class:s.cn("fixed inset-0 z-50 bg-black/80",s.props.class)}),null,16,["class"])}const Qa=Z(Wa,[["render",Ya]]),Ga=L({__name:"DrawerContent",props:{forceMount:{type:Boolean},trapFocus:{type:Boolean},disableOutsidePointerEvents:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","openAutoFocus","closeAutoFocus"],setup(t,{expose:e,emit:n}){e();const s=t,r=n,o=ut(s,r),i={props:s,emits:r,forwarded:o,get DrawerContent(){return Ha},get DrawerPortal(){return En},DrawerOverlay:Qa,get cn(){return oe}};return Object.defineProperty(i,"__isScriptSetup",{enumerable:!1,value:!0}),i}});function Ja(t,e,n,s,r,o){return I(),J(s.DrawerPortal,null,{default:x(()=>[O(s.DrawerOverlay),O(s.DrawerContent,_e(s.forwarded,{class:s.cn("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border border-neutral-200 bg-white dark:border-neutral-800 dark:bg-neutral-950",s.props.class)}),{default:x(()=>[e[0]||(e[0]=R("div",{class:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-neutral-100 dark:bg-neutral-800"},null,-1)),Q(t.$slots,"default")]),_:3},16,["class"])]),_:3})}const Ka=Z(Ga,[["render",Ja]]),Xa=L({__name:"DrawerHeader",props:{class:{}},setup(t,{expose:e}){e();const s={props:t,get cn(){return oe}};return Object.defineProperty(s,"__isScriptSetup",{enumerable:!1,value:!0}),s}});function el(t,e,n,s,r,o){return I(),X("div",{class:lt(s.cn("grid gap-1.5 p-4 text-center sm:text-left",s.props.class))},[Q(t.$slots,"default")],2)}const tl=Z(Xa,[["render",el]]),nl=L({__name:"DrawerFooter",props:{class:{}},setup(t,{expose:e}){e();const s={props:t,get cn(){return oe}};return Object.defineProperty(s,"__isScriptSetup",{enumerable:!1,value:!0}),s}});function sl(t,e,n,s,r,o){return I(),X("div",{class:lt(s.cn("mt-auto flex flex-col gap-2 p-4",s.props.class))},[Q(t.$slots,"default")],2)}const rl=Z(nl,[["render",sl]]),ol=L({__name:"DrawerTitle",props:{asChild:{type:Boolean},as:{},class:{}},setup(t,{expose:e}){e();const n=t,s=Y(()=>{const{class:o,...i}=n;return i}),r={props:n,delegatedProps:s,get DrawerTitle(){return Pn},get cn(){return oe}};return Object.defineProperty(r,"__isScriptSetup",{enumerable:!1,value:!0}),r}});function il(t,e,n,s,r,o){return I(),J(s.DrawerTitle,_e(s.delegatedProps,{class:s.cn("text-lg font-semibold leading-none tracking-tight",s.props.class)}),{default:x(()=>[Q(t.$slots,"default")]),_:3},16,["class"])}const al=Z(ol,[["render",il]]),ll=L({__name:"DrawerDescription",props:{asChild:{type:Boolean},as:{},class:{}},setup(t,{expose:e}){e();const n=t,s=Y(()=>{const{class:o,...i}=n;return i}),r={props:n,delegatedProps:s,get DrawerDescription(){return Dn},get cn(){return oe}};return Object.defineProperty(r,"__isScriptSetup",{enumerable:!1,value:!0}),r}});function ul(t,e,n,s,r,o){return I(),J(s.DrawerDescription,_e(s.delegatedProps,{class:s.cn("text-sm text-neutral-500 dark:text-neutral-400",s.props.class)}),{default:x(()=>[Q(t.$slots,"default")]),_:3},16,["class"])}const cl=Z(ll,[["render",ul]]),dl=L({__name:"ButtonQuestion",setup(t,{expose:e}){e();const{toast:n}=kn(),s=E(""),o={toast:n,questionText:s,handleSubmit:()=>{if(!s.value){n({title:"Campos vacíos.",description:"Debes escribir una pregunta.",variant:"destructive"});return}Ei(s.value,new Date().toISOString()),s.value="",n({description:"Respuesta enviada correctamente."}),setTimeout(()=>{location.reload()},500)},get Drawer(){return Za},get DrawerClose(){return Tn},get DrawerContent(){return Ka},get DrawerDescription(){return cl},get DrawerFooter(){return rl},get DrawerHeader(){return tl},get DrawerTitle(){return al},get DrawerTrigger(){return In}};return Object.defineProperty(o,"__isScriptSetup",{enumerable:!1,value:!0}),o}}),fl={class:"flex items-center justify-center gap-4"};function hl(t,e,n,s,r,o){return I(),J(s.Drawer,null,{default:x(()=>[O(s.DrawerTrigger,null,{default:x(()=>e[1]||(e[1]=[R("button",{class:"w-full md:w-auto mb-14 inline-flex items-center justify-center py-3 px-7 text-base font-semibold text-center text-white rounded-full bg-indigo-600 shadow-xs hover:bg-indigo-700 transition-all duration-500"},[_n(" ¡Haz una pregunta! "),R("svg",{class:"ml-2",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[R("path",{d:"M7.5 15L11.0858 11.4142C11.7525 10.7475 12.0858 10.4142 12.0858 10C12.0858 9.58579 11.7525 9.25245 11.0858 8.58579L7.5 5",stroke:"white","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)])),_:1}),O(s.DrawerContent,null,{default:x(()=>[O(s.DrawerHeader,null,{default:x(()=>[O(s.DrawerTitle,null,{default:x(()=>e[2]||(e[2]=[R("p",{class:"text-neutral-700"},"Escribe tu pregunta",-1)])),_:1}),O(s.DrawerDescription,null,{default:x(()=>[Sn(R("textarea",{"onUpdate:modelValue":e[0]||(e[0]=i=>s.questionText=i),class:"w-full h-32 p-4 mt-4 text-sm text-gray-600 placeholder-gray-400 bg-gray-100 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Escribe tu pregunta"},null,512),[[xn,s.questionText]])]),_:1})]),_:1}),O(s.DrawerFooter,null,{default:x(()=>[R("div",fl,[R("button",{onClick:s.handleSubmit,class:"bg-indigo-600 w-full px-4 py-2 rounded-2xl text-white"},"Enviar"),O(s.DrawerClose,{class:"w-full"},{default:x(()=>e[3]||(e[3]=[R("button",{class:"border text-indigo-600 border-indigo-600 w-full px-4 py-2 rounded-2xl"},"Cerrar",-1)])),_:1})])]),_:1})]),_:1})]),_:1})}const pl=Z(dl,[["render",hl]]),ml=L({__name:"Questions",async setup(t,{expose:e}){e();let n,s;const r=([n,s]=Xs(()=>$i()),n=await n,s(),n),o=[];console.log(r);const i={questions:r,questions2:o,CardQuestion:Ta,ButtonQuestion:pl};return Object.defineProperty(i,"__isScriptSetup",{enumerable:!1,value:!0}),i}}),yl={class:"w-full flex flex-col items-center gap-y-3"},wl={class:"w-full flex flex-col items-center"},bl={class:"cursor-pointer bg-white shadow-lg hover:shadow-xl transition-shadow shadow-slate-200/50 hover:shadow-slate-200 p-4 rounded-xl w-full max-w-2xl flex items-center justify-between gap-x-4"},gl={class:"text-lg font-semibold text-slate-600 text-left line-clamp-1"},vl={class:"flex items-center gap-2 text-slate-400"},_l={class:"font-semibold"},Sl={key:1};function xl(t,e,n,s,r,o){return I(),X("div",yl,[O(s.ButtonQuestion),s.questions.length>0?(I(!0),X(gn,{key:0},vn(s.questions,i=>(I(),X("div",wl,[O(s.CardQuestion,{data:i},{default:x(()=>[R("div",bl,[R("p",gl,Ce(i.question),1),R("section",vl,[e[0]||(e[0]=R("svg",{xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"20",height:"20",viewBox:"0,0,256,256"},[R("g",{fill:"currentColor","fill-rule":"nonzero",stroke:"none","stroke-width":"1","stroke-linecap":"butt","stroke-linejoin":"miter","stroke-miterlimit":"10","stroke-dasharray":"","stroke-dashoffset":"0","font-family":"none","font-weight":"none","font-size":"none","text-anchor":"none",style:{"mix-blend-mode":"normal"}},[R("g",{transform:"scale(10.66667,10.66667)"},[R("path",{d:"M12,2c-5.523,0 -10,4.477 -10,10c0,1.592 0.382,3.091 1.043,4.427l-1.005,4.019c-0.229,0.915 0.6,1.745 1.516,1.516l4.019,-1.005c1.336,0.661 2.835,1.043 4.427,1.043c5.523,0 10,-4.477 10,-10c0,-5.523 -4.477,-10 -10,-10z",opacity:"0.35"}),R("path",{d:"M15,11h-6c-0.553,0 -1,-0.448 -1,-1c0,-0.552 0.447,-1 1,-1h6c0.553,0 1,0.448 1,1c0,0.552 -0.447,1 -1,1z"}),R("path",{d:"M13,15h-4c-0.553,0 -1,-0.448 -1,-1c0,-0.552 0.447,-1 1,-1h4c0.553,0 1,0.448 1,1c0,0.552 -0.447,1 -1,1z"})])])],-1)),R("span",_l,Ce(i.answer_count),1)])])]),_:2},1032,["data"])]))),256)):(I(),X("div",Sl,e[1]||(e[1]=[R("p",null,"No hay preguntas",-1)])))])}const El=Z(ml,[["render",xl]]);export{El as default};
